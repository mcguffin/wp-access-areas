!function(e){var t=access_areas_admin_page.l10n,i=wp.media.View.extend({template:wp.template("access-area-row"),tagName:"tr",events:{"click a.delete":"delete","click a.edit":"edit"},initialize:function(){wp.media.View.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"before_sync",this.disable),this.listenTo(this.model,"before_destroy",this.disable),this.listenTo(this.model,"sync",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return wp.media.View.prototype.render.apply(this,arguments),this.$el.attr("data-id",this.model.get("id")),this},disable:function(e){return this.$el.addClass("disabled"),this},enable:function(e){return this.$el.removeClass("disabled"),this},delete:function(e){return e.preventDefault(),this.model.destroy(),this},edit:function(e){return this.controller.editEntry(this.model),this},delete:function(e){return this.model.destroy(),this}}),s=wp.media.View.extend({events:{"click .add":"newEntry"},initialize:function(){var e=this;wp.media.View.prototype.initialize.apply(this,arguments),this.collection=new wp.api.collections.AccessArea,this.collection.fetch(),this.collection.once("sync",this.render,this),this.listenTo(this.collection,"add",function(t){e.addRow(t),console.log(arguments)}),this.listenTo(this.collection,"remove",function(t){e.setPlaceholder()}),this.render()},newEntry:function(e){var t=new wp.api.models.AccessArea({ID:null,title:""});return this.editEntry(t),this},editEntry:function(e){var t=this;return this.modal.model=e,this.modal.render().open({}),this.listenTo(e,"sync",function(i){t.stopListening(e,"sync"),t.collection.where({id:e.get("id")}).length||t.collection.add(e)}),this},addRow:function(e){var t=this,s=new i({model:e,controller:this});return this.$el.append(s.render().el),this.listenTo(e,"destroy",function(e){s.$el.remove(),t.setPlaceholder()}),this.setPlaceholder(),this},hasRow:function(e){return this.$('[data-id="'+e.get("id")+'"]').length>0},render:function(){return this.modal||(this.modal=new n({controller:this})),wp.media.View.prototype.render.apply(this,arguments),this.$placeholder=this.$(".placeholder-row"),this.collection.each(function(e){}),this.setPlaceholder(),this},setPlaceholder:function(){console.log(this.$placeholder,this.$placeholder.parent().length),this.collection.length?this.$placeholder.remove():this.$placeholder.parent().length||this.$placeholder.appendTo(this.el)}}),n=wp.media.view.Modal.extend({template:wp.template("access-area-modal"),events:{"click .modal-close":"close","click #btn-ok":"save","keyup #title-input":"setUIState","changed #title-input":"setUIState","blur #title-input":"setUIState",keyup:"onkeyup"},setUIState:function(e){return this.$okay.prop("disabled",!this.$title.val()),this},render:function(){return wp.media.view.Modal.prototype.render.apply(this,arguments),this.$okay=this.$("#btn-ok"),this.$title=this.$("#title-input"),this.$title.val(this.model.get("title")),this.setUIState(),this},onkeyup:function(e){27===e.originalEvent.keyCode&&this.close()},open:function(){wp.media.view.Modal.prototype.open.apply(this,arguments),this.$(".title").text(this.model.get("id")?t.editAccessArea:t.createAccessArea)},save:function(){var e=this;this.model.set("title",this.$title.val()),this.model.save(null,{success:function(t){e.close()},error:function(e,t){var i=new Backbone.Model(t.responseJSON),s=new l({model:i});i.set("dismissible",!0),i.set("type","error"),s.render().$el.prependTo(this.$(".modal-content"))}})}}),l=wp.media.View.extend({template:wp.template("access-area-notice"),events:{"click .notice-dismiss":function(){this.$el.remove()}}});e(document).ready(function(){new s({el:e(".access-areas-list-table").get(0)})})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXJzLmpzIl0sIm5hbWVzIjpbIiQiLCJsMTBuIiwiYWNjZXNzX2FyZWFzX2FkbWluX3BhZ2UiLCJBQVJvd1ZpZXciLCJ3cCIsIm1lZGlhIiwiVmlldyIsImV4dGVuZCIsInRlbXBsYXRlIiwidGFnTmFtZSIsImV2ZW50cyIsImNsaWNrIGEuZGVsZXRlIiwiY2xpY2sgYS5lZGl0IiwiaW5pdGlhbGl6ZSIsInByb3RvdHlwZSIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsImxpc3RlblRvIiwibW9kZWwiLCJkaXNhYmxlIiwicmVuZGVyIiwicmVtb3ZlIiwiJGVsIiwiYXR0ciIsImdldCIsImUiLCJhZGRDbGFzcyIsImVuYWJsZSIsInJlbW92ZUNsYXNzIiwiZGVsZXRlIiwicHJldmVudERlZmF1bHQiLCJkZXN0cm95IiwiZWRpdCIsImNvbnRyb2xsZXIiLCJlZGl0RW50cnkiLCJBQVRhYmxlVmlldyIsImNsaWNrIC5hZGQiLCJzZWxmIiwiY29sbGVjdGlvbiIsImFwaSIsImNvbGxlY3Rpb25zIiwiQWNjZXNzQXJlYSIsImZldGNoIiwib25jZSIsImFkZFJvdyIsImNvbnNvbGUiLCJsb2ciLCJzZXRQbGFjZWhvbGRlciIsIm5ld0VudHJ5IiwibW9kZWxzIiwiSUQiLCJ0aXRsZSIsIm1vZGFsIiwib3BlbiIsInN0b3BMaXN0ZW5pbmciLCJ3aGVyZSIsImlkIiwibGVuZ3RoIiwiYWRkIiwidmlldyIsImFwcGVuZCIsImVsIiwiaGFzUm93IiwiQUFNb2RhbCIsIiRwbGFjZWhvbGRlciIsImVhY2giLCJwYXJlbnQiLCJhcHBlbmRUbyIsIk1vZGFsIiwiY2xpY2sgLm1vZGFsLWNsb3NlIiwiY2xpY2sgI2J0bi1vayIsImtleXVwICN0aXRsZS1pbnB1dCIsImNoYW5nZWQgI3RpdGxlLWlucHV0IiwiYmx1ciAjdGl0bGUtaW5wdXQiLCJrZXl1cCIsInNldFVJU3RhdGUiLCIkb2theSIsInByb3AiLCIkdGl0bGUiLCJ2YWwiLCJvbmtleXVwIiwib3JpZ2luYWxFdmVudCIsImtleUNvZGUiLCJjbG9zZSIsInRleHQiLCJlZGl0QWNjZXNzQXJlYSIsImNyZWF0ZUFjY2Vzc0FyZWEiLCJzYXZlIiwic2V0Iiwic3VjY2VzcyIsImVycm9yIiwicmVzcG9uc2UiLCJCYWNrYm9uZSIsIk1vZGVsIiwicmVzcG9uc2VKU09OIiwibm90aWNlIiwiQUFOb3RpY2UiLCJwcmVwZW5kVG8iLCJjbGljayAubm90aWNlLWRpc21pc3MiLCJkb2N1bWVudCIsInJlYWR5IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFVQSxHQWdCVCxJQUFJQyxFQUFPQyx3QkFBd0JELEtBQ2xDRSxFQUFZQyxHQUFHQyxNQUFNQyxLQUFLQyxRQUN6QkMsU0FBU0osR0FBR0ksU0FBUyxtQkFDckJDLFFBQVEsS0FDUkMsUUFDQ0MsaUJBQW9CLFNBQ3BCQyxlQUFtQixRQUVwQkMsV0FBWSxXQUNYVCxHQUFHQyxNQUFNQyxLQUFLUSxVQUFVRCxXQUFXRSxNQUFNQyxLQUFLQyxXQUM5Q0QsS0FBS0UsU0FBVUYsS0FBS0csTUFBTyxjQUFlSCxLQUFLSSxTQUMvQ0osS0FBS0UsU0FBVUYsS0FBS0csTUFBTyxpQkFBa0JILEtBQUtJLFNBQ2xESixLQUFLRSxTQUFVRixLQUFLRyxNQUFPLE9BQVFILEtBQUtLLFFBQ3hDTCxLQUFLRSxTQUFVRixLQUFLRyxNQUFPLFVBQVdILEtBQUtNLFNBRTVDRCxPQUFRLFdBSVAsT0FGQWpCLEdBQUdDLE1BQU1DLEtBQUtRLFVBQVVPLE9BQU9OLE1BQU1DLEtBQUtDLFdBQzFDRCxLQUFLTyxJQUFJQyxLQUFLLFVBQVVSLEtBQUtHLE1BQU1NLElBQUksT0FDaENULE1BRVJJLFFBQVEsU0FBU00sR0FFaEIsT0FEQVYsS0FBS08sSUFBSUksU0FBUyxZQUNYWCxNQUVSWSxPQUFPLFNBQVNGLEdBRWYsT0FEQVYsS0FBS08sSUFBSU0sWUFBWSxZQUNkYixNQUVSYyxPQUFPLFNBQVNKLEdBR2YsT0FGQUEsRUFBRUssaUJBQ0ZmLEtBQUtHLE1BQU1hLFVBQ0poQixNQUVSaUIsS0FB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OiJ1c2Vycy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oJCl7XG5cdC8vIHdwQXBpU2V0dGluZ3MubWFwcGluZyA9IHtcblx0Ly8gXHRtb2RlbHM6IHtcblx0Ly8gXHRcdCdBY2Nlc3NBcmVhcycgOiAnQWNjZXNzQXJlYSdcblx0Ly8gXHR9LFxuXHQvLyBcdGNvbGxlY3Rpb25zOnt9XG5cdC8vIH07XG5cdC8vIHdwLmFwaS5pbml0KHtcblx0Ly8gXHR2ZXJzaW9uU3RyaW5nIDogJ3dwYWEvdjEvJyxcblx0Ly8gXHRhcGlSb290OiB3cEFwaVNldHRpbmdzLnJvb3QsXG5cdC8vIFx0c2NoZW1hOiBudWxsLFxuXHQvLyBcdH0pXG5cdC8vIFx0LmRvbmUoIGZ1bmN0aW9uKCkge1xuXHQvLyBcdFx0Y29uc29sZS5sb2codGhpcywgd3AuYXBpLmVuZHBvaW50cy5maW5kKHt2ZXJzaW9uU3RyaW5nOid3cGFhL3YxLyd9KSApO1xuXHQvLyBcdH0pO1xuXG5cdHZhciBsMTBuID0gYWNjZXNzX2FyZWFzX2FkbWluX3BhZ2UubDEwbixcblx0XHRBQVJvd1ZpZXcgPSB3cC5tZWRpYS5WaWV3LmV4dGVuZCh7XG5cdFx0XHR0ZW1wbGF0ZTp3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtcm93JyksXG5cdFx0XHR0YWdOYW1lOid0cicsXG5cdFx0XHRldmVudHM6IHtcblx0XHRcdFx0J2NsaWNrIGEuZGVsZXRlJ1x0XHQ6ICdkZWxldGUnLFxuXHRcdFx0XHQnY2xpY2sgYS5lZGl0J1x0XHRcdDogJ2VkaXQnLFxuXHRcdFx0fSxcblx0XHRcdGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5pbml0aWFsaXplLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy5tb2RlbCwgJ2JlZm9yZV9zeW5jJywgdGhpcy5kaXNhYmxlICk7XG5cdFx0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMubW9kZWwsICdiZWZvcmVfZGVzdHJveScsIHRoaXMuZGlzYWJsZSApO1xuXHRcdFx0XHR0aGlzLmxpc3RlblRvKCB0aGlzLm1vZGVsLCAnc3luYycsIHRoaXMucmVuZGVyICk7XG5cdFx0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMubW9kZWwsICdkZXN0cm95JywgdGhpcy5yZW1vdmUgKTtcblx0XHRcdH0sXG5cdFx0XHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHRcdHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLnJlbmRlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0XHRcdHRoaXMuJGVsLmF0dHIoJ2RhdGEtaWQnLHRoaXMubW9kZWwuZ2V0KCdpZCcpKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9LFxuXHRcdFx0ZGlzYWJsZTpmdW5jdGlvbihlKXtcblx0XHRcdFx0dGhpcy4kZWwuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fSxcblx0XHRcdGVuYWJsZTpmdW5jdGlvbihlKXtcblx0XHRcdFx0dGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fSxcblx0XHRcdGRlbGV0ZTpmdW5jdGlvbihlKXtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR0aGlzLm1vZGVsLmRlc3Ryb3koKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9LFxuXHRcdFx0ZWRpdDpmdW5jdGlvbihlKXtcblx0XHRcdFx0dGhpcy5jb250cm9sbGVyLmVkaXRFbnRyeSh0aGlzLm1vZGVsKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9LFxuXHRcdFx0ZGVsZXRlOmZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR0aGlzLm1vZGVsLmRlc3Ryb3koKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cdFx0fSksXG5cdFx0QUFUYWJsZVZpZXcgPSB3cC5tZWRpYS5WaWV3LmV4dGVuZCh7XG5cdFx0XHRldmVudHM6IHtcblx0XHRcdFx0J2NsaWNrIC5hZGQnIDogJ25ld0VudHJ5Jyxcblx0XHRcdH0sXG5cdFx0XHRpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5pbml0aWFsaXplLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHRcdFx0dGhpcy5jb2xsZWN0aW9uID0gbmV3IHdwLmFwaS5jb2xsZWN0aW9ucy5BY2Nlc3NBcmVhKCk7XG5cdFx0XHRcdHRoaXMuY29sbGVjdGlvbi5mZXRjaCgpO1xuXHRcdFx0XHR0aGlzLmNvbGxlY3Rpb24ub25jZSgnc3luYycsdGhpcy5yZW5kZXIsdGhpcyk7XG5cdFx0XHRcdHRoaXMubGlzdGVuVG8odGhpcy5jb2xsZWN0aW9uLCdhZGQnLGZ1bmN0aW9uKG1vZGVsKXtcblx0XHRcdFx0XHRzZWxmLmFkZFJvdyhtb2RlbCk7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coYXJndW1lbnRzKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHRoaXMubGlzdGVuVG8odGhpcy5jb2xsZWN0aW9uLCdyZW1vdmUnLGZ1bmN0aW9uKG1vZGVsKXtcblx0XHRcdFx0XHRzZWxmLnNldFBsYWNlaG9sZGVyKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHR0aGlzLnJlbmRlcigpO1xuXHRcdFx0fSxcblx0XHRcdG5ld0VudHJ5OmZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIG1vZGVsID0gbmV3IHdwLmFwaS5tb2RlbHMuQWNjZXNzQXJlYSh7XG5cdFx0XHRcdFx0XHRJRDogbnVsbCxcblx0XHRcdFx0XHRcdHRpdGxlOiAnJyxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0dGhpcy5lZGl0RW50cnkobW9kZWwpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH0sXG5cdFx0XHRlZGl0RW50cnk6ZnVuY3Rpb24obW9kZWwpIHtcblx0XHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0XHQvLyBvcGVuIG1vZGFsXG5cdFx0XHRcdHRoaXMubW9kYWwubW9kZWwgPSBtb2RlbDtcblx0XHRcdFx0dGhpcy5tb2RhbC5yZW5kZXIoKS5vcGVuKHt9KTtcblx0XHRcdFx0dGhpcy5saXN0ZW5Ubyhtb2RlbCwnc3luYycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0c2VsZi5zdG9wTGlzdGVuaW5nKG1vZGVsLCdzeW5jJyk7XG5cdFx0XHRcdFx0aWYgKCAhIHNlbGYuY29sbGVjdGlvbi53aGVyZSggeyBpZDogbW9kZWwuZ2V0KCdpZCcpIH0gKS5sZW5ndGggKSB7XG5cdFx0XHRcdFx0XHRzZWxmLmNvbGxlY3Rpb24uYWRkKG1vZGVsKTtcbi8vXHRcdFx0XHRcdFx0c2VsZi5hZGRSb3cobW9kZWwpO1xuXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9LFxuXHRcdFx0YWRkUm93OmZ1bmN0aW9uKCBtb2RlbCApe1xuXHRcdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdFx0dmlldyA9IG5ldyBBQVJvd1ZpZXcoe1xuXHRcdFx0XHRcdFx0bW9kZWw6bW9kZWwsXG5cdFx0XHRcdFx0XHRjb250cm9sbGVyOnRoaXMsXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdHRoaXMuJGVsLmFwcGVuZCggdmlldy5yZW5kZXIoKS5lbCApO1xuXHRcdFx0XHR0aGlzLmxpc3RlblRvKCBtb2RlbCwnZGVzdHJveScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0dmlldy4kZWwucmVtb3ZlKCk7XG5cdFx0XHRcdFx0c2VsZi5zZXRQbGFjZWhvbGRlcigpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0dGhpcy5zZXRQbGFjZWhvbGRlcigpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH0sXG5cdFx0XHRoYXNSb3c6ZnVuY3Rpb24obW9kZWwpe1xuXHRcdFx0XHRyZXR1cm4gdGhpcy4kKCdbZGF0YS1pZD1cIicrbW9kZWwuZ2V0KCdpZCcpKydcIl0nKS5sZW5ndGggPiAwO1xuXHRcdFx0fSxcblx0XHRcdHJlbmRlcjogZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRcdGlmICggISB0aGlzLm1vZGFsICkge1xuXHRcdFx0XHRcdHRoaXMubW9kYWwgPSBuZXcgQUFNb2RhbCh7XG5cdFx0XHRcdFx0XHRjb250cm9sbGVyOlx0dGhpcyxcblx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXG5cdFx0XHRcdHRoaXMuJHBsYWNlaG9sZGVyID0gdGhpcy4kKCcucGxhY2Vob2xkZXItcm93Jyk7XG5cblx0XHRcdFx0dGhpcy5jb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24obW9kZWwpe1xuLy9cdFx0XHRcdFx0c2VsZi5hZGRSb3cobW9kZWwpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0dGhpcy5zZXRQbGFjZWhvbGRlcigpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH0sXG5cdFx0XHRzZXRQbGFjZWhvbGRlcjpmdW5jdGlvbigpe1xuXHRcdFx0XHRjb25zb2xlLmxvZyh0aGlzLiRwbGFjZWhvbGRlcix0aGlzLiRwbGFjZWhvbGRlci5wYXJlbnQoKS5sZW5ndGgpXG5cdFx0XHRcdGlmICggdGhpcy5jb2xsZWN0aW9uLmxlbmd0aCApIHtcblx0XHRcdFx0XHR0aGlzLiRwbGFjZWhvbGRlci5yZW1vdmUoKTtcblx0XHRcdFx0fSBlbHNlIGlmICggISB0aGlzLiRwbGFjZWhvbGRlci5wYXJlbnQoKS5sZW5ndGggKSB7XG5cdFx0XHRcdFx0dGhpcy4kcGxhY2Vob2xkZXIuYXBwZW5kVG8oIHRoaXMuZWwgKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pLFxuXHRcdEFBTW9kYWwgPSB3cC5tZWRpYS52aWV3Lk1vZGFsLmV4dGVuZCh7XG5cdFx0XHR0ZW1wbGF0ZTp3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtbW9kYWwnKSxcblx0XHRcdGV2ZW50czpcdFx0e1xuXHRcdFx0XHQnY2xpY2sgLm1vZGFsLWNsb3NlJ1x0OiAnY2xvc2UnLFxuXHRcdFx0XHQnY2xpY2sgI2J0bi1vaydcdFx0XHQ6ICdzYXZlJyxcblx0XHRcdFx0J2tleXVwICN0aXRsZS1pbnB1dCdcdDogJ3NldFVJU3RhdGUnLFxuXHRcdFx0XHQnY2hhbmdlZCAjdGl0bGUtaW5wdXQnXHQ6ICdzZXRVSVN0YXRlJyxcblx0XHRcdFx0J2JsdXIgI3RpdGxlLWlucHV0J1x0XHQ6ICdzZXRVSVN0YXRlJyxcblx0XHRcdFx0J2tleXVwJ1x0XHRcdFx0XHQ6ICdvbmtleXVwJyxcblx0XHRcdH0sXG5cdFx0XHRzZXRVSVN0YXRlOmZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR0aGlzLiRva2F5LnByb3AoJ2Rpc2FibGVkJywhdGhpcy4kdGl0bGUudmFsKCkpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH0sXG5cdFx0XHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR3cC5tZWRpYS52aWV3Lk1vZGFsLnByb3RvdHlwZS5yZW5kZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xuXHRcdFx0XHR0aGlzLiRva2F5ID0gdGhpcy4kKCcjYnRuLW9rJyk7XG5cdFx0XHRcdHRoaXMuJHRpdGxlID0gdGhpcy4kKCcjdGl0bGUtaW5wdXQnKTtcblx0XHRcdFx0dGhpcy4kdGl0bGUudmFsKCB0aGlzLm1vZGVsLmdldCggJ3RpdGxlJyApICk7XG5cdFx0XHRcdHRoaXMuc2V0VUlTdGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH0sXG5cdFx0XHRvbmtleXVwOmZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKCBlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSA9PT0gMjcgKSB7XG5cdFx0XHRcdFx0dGhpcy5jbG9zZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0b3BlbjpmdW5jdGlvbigpe1xuXHRcdFx0XHR3cC5tZWRpYS52aWV3Lk1vZGFsLnByb3RvdHlwZS5vcGVuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcblx0XHRcdFx0dGhpcy4kKCcudGl0bGUnKS50ZXh0KCAhISB0aGlzLm1vZGVsLmdldCgnaWQnKSA/IGwxMG4uZWRpdEFjY2Vzc0FyZWEgOiBsMTBuLmNyZWF0ZUFjY2Vzc0FyZWEgKTtcblx0XHRcdH0sXG5cdFx0XHRzYXZlOmZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdFx0dGhpcy5tb2RlbC5zZXQoJ3RpdGxlJywgdGhpcy4kdGl0bGUudmFsKCkgKTtcblx0XHRcdFx0dGhpcy5tb2RlbC5zYXZlKCBudWxsLCB7XG5cdFx0XHRcdFx0c3VjY2VzczogZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0XHRcdFx0Ly8gYWRkIG1lc3NhZ2Vcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGVycm9yOiBmdW5jdGlvbihlLHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHR2YXIgbW9kZWwgPSBuZXcgQmFja2JvbmUuTW9kZWwocmVzcG9uc2UucmVzcG9uc2VKU09OKSxcblx0XHRcdFx0XHRcdFx0bm90aWNlID0gbmV3IEFBTm90aWNlKHtcblx0XHRcdFx0XHRcdFx0XHRtb2RlbDogbW9kZWxcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRtb2RlbC5zZXQoJ2Rpc21pc3NpYmxlJyx0cnVlKTtcblx0XHRcdFx0XHRcdG1vZGVsLnNldCgndHlwZScsJ2Vycm9yJyk7XG5cdFx0XHRcdFx0XHQvLyBwcmludCBtZXNzYWdlXG5cdFx0XHRcdFx0XHQvL3RoaXMuJCgnLm5vdGljZScpLnJlbW92ZSgpO1xuXHRcdFx0XHRcdFx0bm90aWNlLnJlbmRlcigpLiRlbC5wcmVwZW5kVG8odGhpcy4kKCcubW9kYWwtY29udGVudCcpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSxcblx0XHR9KSxcblx0XHRBQU5vdGljZSA9IHdwLm1lZGlhLlZpZXcuZXh0ZW5kKHtcblx0XHRcdHRlbXBsYXRlOiB3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtbm90aWNlJyksXG5cdFx0XHRldmVudHM6e1xuXHRcdFx0XHQnY2xpY2sgLm5vdGljZS1kaXNtaXNzJyA6IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0dGhpcy4kZWwucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KSxcblx0XHR0YWJsZVZpZXcsIGFhTW9kYWw7XG5cblxuXHQkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xuXHRcdHRhYmxlVmlldyA9IG5ldyBBQVRhYmxlVmlldyh7XG5cdFx0XHRlbDokKCcuYWNjZXNzLWFyZWFzLWxpc3QtdGFibGUnKS5nZXQoMClcblx0XHR9KTtcblx0fSlcbn0pKGpRdWVyeSk7XG4iXX0=
