!function(e,t){var i=access_areas_admin.l10n,s={l10n:i,view:{},model:{}};s.model.Assign=Backbone.Model.extend({defaults:{id:null,action:"grant",users:[]},save:function(){this.url=wpApiSettings.root+wpApiSettings.versionString+"access-area/"+this.get("id")+"/"+this.get("action"),Backbone.Model.prototype.save.apply(this,arguments)}}),s.view.Notice=wp.media.View.extend({template:wp.template("access-area-notice"),events:{"click .notice-dismiss":function(){this.$el.remove()}}}),s.view.RowViewManage=wp.media.View.extend({template:wp.template("access-area-row"),tagName:"tr",events:{"click a.delete":"delete","click a.edit":"edit"},initialize:function(){wp.media.View.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"before_sync",this.disable),this.listenTo(this.model,"before_destroy",this.disable),this.listenTo(this.model,"sync",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return wp.media.View.prototype.render.apply(this,arguments),this.$el.attr("data-id",this.model.get("id")),this},disable:function(e){return this.$el.addClass("disabled"),this},enable:function(e){return this.$el.removeClass("disabled"),this},delete:function(e){return e.preventDefault(),this.model.destroy(),this},edit:function(e){return this.controller.editEntry(this.model),this},delete:function(e){return this.model.destroy(),this}}),s.view.TableViewManage=wp.media.View.extend({events:{"click .add":"newEntry"},initialize:function(){var e=this;wp.media.View.prototype.initialize.apply(this,arguments),this.collection=new wp.api.collections.AccessArea,this.collection.fetch(),this.collection.once("sync",this.render,this),this.listenTo(this.collection,"add",function(t){e.addRow(t),console.log(arguments)}),this.listenTo(this.collection,"remove",function(t){e.setPlaceholder()}),this.render()},newEntry:function(e){var t=new wp.api.models.AccessArea({ID:null,title:""});return this.editEntry(t),this},editEntry:function(e){var t=this;return this.modal.model=e,this.modal.render().open({}),this.listenTo(e,"sync",function(i){t.stopListening(e,"sync"),t.collection.where({id:e.get("id")}).length||t.collection.add(e)}),this},addRow:function(e){var t=this,i=new s.view.RowViewManage({model:e,controller:this});return this.$el.append(i.render().el),this.listenTo(e,"destroy",function(e){i.$el.remove(),t.setPlaceholder()}),this.setPlaceholder(),this},hasRow:function(e){return this.$('[data-id="'+e.get("id")+'"]').length>0},render:function(){return this.modal||(this.modal=new s.view.ModalManage({controller:this})),wp.media.View.prototype.render.apply(this,arguments),this.$placeholder=this.$(".placeholder-row"),this.setPlaceholder(),this},setPlaceholder:function(){this.collection.length?this.$placeholder.remove():this.$placeholder.parent().length||this.$placeholder.appendTo(this.el)}}),s.view.ModalManage=wp.media.view.Modal.extend({template:wp.template("access-area-modal"),events:{"click .modal-close":"close","click #btn-ok":"save","keyup #title-input":"setUIState","change #title-input":"setUIState","blur #title-input":"setUIState",keyup:"onkeyup"},setUIState:function(e){return this.$okay.prop("disabled",!this.$title.val()),this},render:function(){return wp.media.view.Modal.prototype.render.apply(this,arguments),this.$okay=this.$("#btn-ok"),this.$title=this.$("#title-input"),this.$title.val(this.model.get("title")),this.setUIState(),this},onkeyup:function(e){27===e.originalEvent.keyCode&&this.close()},open:function(){wp.media.view.Modal.prototype.open.apply(this,arguments),this.$(".title").text(this.model.get("id")?i.editAccessArea:i.createAccessArea),this.setUIState()},save:function(){var e=this;this.model.set("title",this.$title.val()),this.model.save(null,{success:function(t){e.close()},error:function(e,t){var i=new Backbone.Model(t.responseJSON),s=new wp.accessAreas.view.Notice({model:i});i.set("dismissible",!0),i.set("type","error"),s.render().$el.prependTo(this.$(".modal-content"))}})}}),s.view.ModalAssign=wp.media.view.Modal.extend({template:wp.template("access-area-assign-modal"),events:{"click .modal-close":"close","click #btn-ok":"save","change select":"setUIState",keyup:"onkeyup"},onkeyup:function(e){return 27===e.originalEvent.keyCode&&this.close(),this},render:function(){return wp.media.view.Modal.prototype.render.apply(this,arguments),this.$okay=this.$("#btn-ok"),this.setUIState(),this},open:function(){return wp.media.view.Modal.prototype.open.apply(this,arguments),this.$(".title").text("grant"===this.model.get("action")?i.grantAccess:i.revokeAccess),this.$("select").val(""),this.setUIState(),this},setUIState:function(e){return console.log(this.$("select").val()),this.$okay.prop("disabled",""===this.$("select").val()),this},save:function(){var t=this;return this.model.set("id",this.$("select").val()),this.model.save(null,{success:function(i,s){var a=t.model.get("action");_.each(s.user_id,function(t,i){if("grant"===a){var n=e('.assign-access-areas[data-wpaa-user="'+t+'"]'),o=wp.template("access-area-assigned-user")(e.extend(s.access_area,{user_id:s.user_id}));n.prepend(o)}else"revoke"===a&&e('[data-wpaa-access-area="'+s.access_area.id+'"][data-wpaa-user="'+t+'"]').closest(".wpaa-access-area").remove()}),t.close()},error:function(e,t){var i=new Backbone.Model(t.responseJSON),s=new wp.accessAreas.view.Notice({model:i});i.set("dismissible",!0),i.set("type","error"),s.render().$el.prependTo(this.$(".modal-content"))}}),this}}),t.accessAreas=s}(jQuery,wp),function(e,t){var i=wp.accessAreas;e(document).ready(function(){var t=e(".access-areas-list-table");t.length&&new i.view.TableViewManage({el:t.get(0)})})}(jQuery),function(e,t){var i=wp.accessAreas,s=new i.model.Assign,a=new i.view.ModalAssign({model:s,propagate:!1});e(document).on("click","body.users-php .button.action",function(t){var i=e(this).prev("select").val(),n=[];t.preventDefault(),-1!==["wpaa-grant","wpaa-revoke"].indexOf(i)&&(e('[name="users[]"]:checked').each(function(t,i){n.push(e(this).val())}),s.set("action",i.replace("wpaa-","")),s.set("user_id",n),a.open())}).on("click","[data-wpaa-action]",function(t){t.preventDefault();var i=e(this).attr("data-wpaa-action"),n=this;s.set("action",i),s.set("user_id",e(this).attr("data-wpaa-user")),"revoke"===i?(s.set("id",e(this).attr("data-wpaa-access-area")),s.save(null,{success:function(){e(n).closest(".wpaa-access-area").remove()},error:function(t,i){var s=new Backbone.Model(i.responseJSON),a=new wp.accessAreas.view.Notice({model:s});s.set("dismissible",!0),s.set("type","error"),a.render().$el.insertfter(e(".wp-header-end"))}})):"grant"===i&&a.open()})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJtYW5hZ2UuanMiLCJ1c2Vycy5qcyJdLCJuYW1lcyI6WyIkIiwiZXhwb3J0cyIsImwxMG4iLCJhY2Nlc3NfYXJlYXNfYWRtaW4iLCJ3cGFhIiwidmlldyIsIm1vZGVsIiwiQXNzaWduIiwiQmFja2JvbmUiLCJNb2RlbCIsImV4dGVuZCIsImRlZmF1bHRzIiwiaWQiLCJhY3Rpb24iLCJ1c2VycyIsInNhdmUiLCJ0aGlzIiwidXJsIiwid3BBcGlTZXR0aW5ncyIsInJvb3QiLCJ2ZXJzaW9uU3RyaW5nIiwiZ2V0IiwicHJvdG90eXBlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJOb3RpY2UiLCJ3cCIsIm1lZGlhIiwiVmlldyIsInRlbXBsYXRlIiwiZXZlbnRzIiwiY2xpY2sgLm5vdGljZS1kaXNtaXNzIiwiJGVsIiwicmVtb3ZlIiwiUm93Vmlld01hbmFnZSIsInRhZ05hbWUiLCJjbGljayBhLmRlbGV0ZSIsImNsaWNrIGEuZWRpdCIsImluaXRpYWxpemUiLCJsaXN0ZW5UbyIsImRpc2FibGUiLCJyZW5kZXIiLCJhdHRyIiwiZSIsImFkZENsYXNzIiwiZW5hYmxlIiwicmVtb3ZlQ2xhc3MiLCJkZWxldGUiLCJwcmV2ZW50RGVmYXVsdCIsImRlc3Ryb3kiLCJlZGl0IiwiY29udHJvbGxlciIsImVkaXRFbnRyeSIsIlRhYmxlVmlld01hbmFnZSIsImNsaWNrIC5hZGQiLCJzZWxmIiwiY29sbGVjdGlvbiIsImFwaSIsImNvbGxlY3Rpb25zIiwiQWNjZXNzQXJlYSIsImZldGNoIiwib25jZSIsImFkZFJvdyIsImNvbnNvbGUiLCJsb2ciLCJzZXRQbGFjZWhvbGRlciIsIm5ld0VudHJ5IiwibW9kZWxzIiwiSUQiLCJ0aXRsZSIsIm1vZGFsIiwib3BlbiIsInN0b3BMaXN0ZW5pbmciLCJ3aGVyZSIsImxlbmd0aCIsImFkZCIsImFwcGVuZCIsImVsIiwiaGFzUm93IiwiTW9kYWxNYW5hZ2UiLCIkcGxhY2Vob2xkZXIiLCJwYXJlbnQiLCJhcHBlbmRUbyIsIk1vZGFsIiwiY2xpY2sgLm1vZGFsLWNsb3NlIiwiY2xpY2sgI2J0bi1vayIsImtleXVwICN0aXRsZS1pbnB1dCIsImNoYW5nZSAjdGl0bGUtaW5wdXQiLCJibHVyICN0aXRsZS1pbnB1dCIsImtleXVwIiwic2V0VUlTdGF0ZSIsIiRva2F5IiwicHJvcCIsIiR0aXRsZSIsInZhbCIsIm9ua2V5dXAiLCJvcmlnaW5hbEV2ZW50Iiwia2V5Q29kZSIsImNsb3NlIiwidGV4dCIsImVkaXRBY2Nlc3NBcmVhIiwiY3JlYXRlQWNjZXNzQXJlYSIsInNldCIsInN1Y2Nlc3MiLCJlcnJvciIsInJlc3BvbnNlIiwicmVzcG9uc2VKU09OIiwibm90aWNlIiwiYWNjZXNzQXJlYXMiLCJwcmVwZW5kVG8iLCJNb2RhbEFzc2lnbiIsImNoYW5nZSBzZWxlY3QiLCJncmFudEFjY2VzcyIsInJldm9rZUFjY2VzcyIsIl8iLCJlYWNoIiwidXNlcl9pZCIsImkiLCIkYm94IiwiaHRtbCIsImFjY2Vzc19hcmVhIiwicHJlcGVuZCIsImNsb3Nlc3QiLCJqUXVlcnkiLCJkb2N1bWVudCIsInJlYWR5IiwicHJvcGFnYXRlIiwib24iLCJwcmV2IiwiaW5kZXhPZiIsInB1c2giLCJyZXBsYWNlIiwiaW5zZXJ0ZnRlciJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FnQkEsSUFBQUMsRUFBQUMsbUJBQUFELEtBQ0FFLEdBQ0FGLEtBQUFBLEVBQ0FHLFFBQ0FDLFVBR0FGLEVBQUFFLE1BQUFDLE9BQUFDLFNBQUFDLE1BQUFDLFFBQ0FDLFVBQ0FDLEdBQUEsS0FDQUMsT0FBQSxRQUNBQyxVQUVBQyxLQUFBLFdBRUFDLEtBQUFDLElBQUFDLGNBQUFDLEtBQUFELGNBQUFFLGNBQUEsZUFBQUosS0FBQUssSUFBQSxNQUFBLElBQUFMLEtBQUFLLElBQUEsVUFDQWIsU0FBQUMsTUFBQWEsVUFBQVAsS0FBQVEsTUFBQVAsS0FBQVEsY0FLQXBCLEVBQUFDLEtBQUFvQixPQUFBQyxHQUFBQyxNQUFBQyxLQUFBbEIsUUFDQW1CLFNBQUFI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QXBDLEVBQUFTLEtBQUEsTUFDQXdGLFFBQUEsV0FDQXZHLEVBQUF1RCxHQUFBbUUsUUFBQSxxQkFBQXpGLFVBRUF1RSxNQUFBLFNBQUE3RCxFQUFBOEQsR0FDQSxJQUFBbkcsRUFBQSxJQUFBRSxTQUFBQyxNQUFBZ0csRUFBQUMsY0FDQUMsRUFBQSxJQUFBakYsR0FBQWtGLFlBQUF2RyxLQUFBb0IsUUFDQW5CLE1BQUFBLElBRUFBLEVBQUFnRyxJQUFBLGVBQUEsR0FDQWhHLEVBQUFnRyxJQUFBLE9BQUEsU0FHQUssRUFBQWxFLFNBQUFULElBQUFvRyxXQUFBcEksRUFBQSx1QkFHQSxVQUFBYSxHQUNBeUQsRUFBQUMsU0FwREEsQ0E4REFvRCIsImZpbGUiOiJhY2Nlc3MtYXJlYXMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCQsZXhwb3J0cyl7XG5cdC8vIHdwQXBpU2V0dGluZ3MubWFwcGluZyA9IHtcblx0Ly8gXHRtb2RlbHM6IHtcblx0Ly8gXHRcdCdBY2Nlc3NBcmVhcycgOiAnQWNjZXNzQXJlYSdcblx0Ly8gXHR9LFxuXHQvLyBcdGNvbGxlY3Rpb25zOnt9XG5cdC8vIH07XG5cdC8vIHdwLmFwaS5pbml0KHtcblx0Ly8gXHR2ZXJzaW9uU3RyaW5nIDogJ3dwYWEvdjEvJyxcblx0Ly8gXHRhcGlSb290OiB3cEFwaVNldHRpbmdzLnJvb3QsXG5cdC8vIFx0c2NoZW1hOiBudWxsLFxuXHQvLyBcdH0pXG5cdC8vIFx0LmRvbmUoIGZ1bmN0aW9uKCkge1xuXHQvLyBcdFx0Y29uc29sZS5sb2codGhpcywgd3AuYXBpLmVuZHBvaW50cy5maW5kKHt2ZXJzaW9uU3RyaW5nOid3cGFhL3YxLyd9KSApO1xuXHQvLyBcdH0pO1xuXG5cdHZhciBsMTBuID0gYWNjZXNzX2FyZWFzX2FkbWluLmwxMG4sXG5cdFx0d3BhYSA9IHtcblx0XHRcdGwxMG46IGwxMG4sXG5cdFx0XHR2aWV3OiB7fSxcblx0XHRcdG1vZGVsOiB7fVxuXHRcdH07XG5cblx0d3BhYS5tb2RlbC5Bc3NpZ24gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuXHRcdGRlZmF1bHRzOntcblx0XHRcdGlkOiBudWxsLFxuXHRcdFx0YWN0aW9uOidncmFudCcsXG5cdFx0XHR1c2VyczpbXVxuXHRcdH0sXG5cdFx0c2F2ZTpmdW5jdGlvbigpIHtcblxuXHRcdFx0dGhpcy51cmwgPSB3cEFwaVNldHRpbmdzLnJvb3QgKyB3cEFwaVNldHRpbmdzLnZlcnNpb25TdHJpbmcgKyAnYWNjZXNzLWFyZWEvJyArIHRoaXMuZ2V0KCdpZCcpICsgJy8nICsgdGhpcy5nZXQoJ2FjdGlvbicpO1xuXHRcdFx0QmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNhdmUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXG5cdFx0fVxuXHR9KTtcblxuXHR3cGFhLnZpZXcuTm90aWNlID0gd3AubWVkaWEuVmlldy5leHRlbmQoe1xuXHRcdHRlbXBsYXRlOiB3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtbm90aWNlJyksXG5cdFx0ZXZlbnRzOntcblx0XHRcdCdjbGljayAubm90aWNlLWRpc21pc3MnIDogZnVuY3Rpb24oKXtcblx0XHRcdFx0dGhpcy4kZWwucmVtb3ZlKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXHR3cGFhLnZpZXcuUm93Vmlld01hbmFnZSA9IHdwLm1lZGlhLlZpZXcuZXh0ZW5kKHtcblx0XHR0ZW1wbGF0ZTp3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtcm93JyksXG5cdFx0dGFnTmFtZTondHInLFxuXHRcdGV2ZW50czoge1xuXHRcdFx0J2NsaWNrIGEuZGVsZXRlJ1x0XHQ6ICdkZWxldGUnLFxuXHRcdFx0J2NsaWNrIGEuZWRpdCdcdFx0XHQ6ICdlZGl0Jyxcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0d3AubWVkaWEuVmlldy5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0XHR0aGlzLmxpc3RlblRvKCB0aGlzLm1vZGVsLCAnYmVmb3JlX3N5bmMnLCB0aGlzLmRpc2FibGUgKTtcblx0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMubW9kZWwsICdiZWZvcmVfZGVzdHJveScsIHRoaXMuZGlzYWJsZSApO1xuXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy5tb2RlbCwgJ3N5bmMnLCB0aGlzLnJlbmRlciApO1xuXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy5tb2RlbCwgJ2Rlc3Ryb3knLCB0aGlzLnJlbW92ZSApO1xuXHRcdH0sXG5cdFx0cmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLnJlbmRlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0XHR0aGlzLiRlbC5hdHRyKCdkYXRhLWlkJyx0aGlzLm1vZGVsLmdldCgnaWQnKSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGRpc2FibGU6ZnVuY3Rpb24oZSl7XG5cdFx0XHR0aGlzLiRlbC5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0ZW5hYmxlOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGRlbGV0ZTpmdW5jdGlvbihlKXtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHRoaXMubW9kZWwuZGVzdHJveSgpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRlZGl0OmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy5jb250cm9sbGVyLmVkaXRFbnRyeSh0aGlzLm1vZGVsKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0ZGVsZXRlOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy5tb2RlbC5kZXN0cm95KCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH0pO1xuXHR3cGFhLnZpZXcuVGFibGVWaWV3TWFuYWdlID0gd3AubWVkaWEuVmlldy5leHRlbmQoe1xuXHRcdGV2ZW50czoge1xuXHRcdFx0J2NsaWNrIC5hZGQnIDogJ25ld0VudHJ5Jyxcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0d3AubWVkaWEuVmlldy5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0XHR0aGlzLmNvbGxlY3Rpb24gPSBuZXcgd3AuYXBpLmNvbGxlY3Rpb25zLkFjY2Vzc0FyZWEoKTtcblx0XHRcdHRoaXMuY29sbGVjdGlvbi5mZXRjaCgpO1xuXHRcdFx0dGhpcy5jb2xsZWN0aW9uLm9uY2UoJ3N5bmMnLHRoaXMucmVuZGVyLHRoaXMpO1xuXHRcdFx0dGhpcy5saXN0ZW5Ubyh0aGlzLmNvbGxlY3Rpb24sJ2FkZCcsZnVuY3Rpb24obW9kZWwpe1xuXHRcdFx0XHRzZWxmLmFkZFJvdyhtb2RlbCk7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGFyZ3VtZW50cyk7XG5cdFx0XHR9KTtcblx0XHRcdHRoaXMubGlzdGVuVG8odGhpcy5jb2xsZWN0aW9uLCdyZW1vdmUnLGZ1bmN0aW9uKG1vZGVsKXtcblx0XHRcdFx0c2VsZi5zZXRQbGFjZWhvbGRlcigpO1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLnJlbmRlcigpO1xuXHRcdH0sXG5cdFx0bmV3RW50cnk6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dmFyIG1vZGVsID0gbmV3IHdwLmFwaS5tb2RlbHMuQWNjZXNzQXJlYSh7XG5cdFx0XHRcdFx0SUQ6IG51bGwsXG5cdFx0XHRcdFx0dGl0bGU6ICcnLFxuXHRcdFx0XHR9KTtcblx0XHRcdHRoaXMuZWRpdEVudHJ5KG1vZGVsKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0ZWRpdEVudHJ5OmZ1bmN0aW9uKG1vZGVsKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHQvLyBvcGVuIG1vZGFsXG5cdFx0XHR0aGlzLm1vZGFsLm1vZGVsID0gbW9kZWw7XG5cdFx0XHR0aGlzLm1vZGFsLnJlbmRlcigpLm9wZW4oe30pO1xuXHRcdFx0dGhpcy5saXN0ZW5Ubyhtb2RlbCwnc3luYycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYuc3RvcExpc3RlbmluZyhtb2RlbCwnc3luYycpO1xuXHRcdFx0XHRpZiAoICEgc2VsZi5jb2xsZWN0aW9uLndoZXJlKCB7IGlkOiBtb2RlbC5nZXQoJ2lkJykgfSApLmxlbmd0aCApIHtcblx0XHRcdFx0XHRzZWxmLmNvbGxlY3Rpb24uYWRkKG1vZGVsKTtcbi8vXHRcdFx0XHRcdFx0c2VsZi5hZGRSb3cobW9kZWwpO1xuXG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRhZGRSb3c6ZnVuY3Rpb24oIG1vZGVsICl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHZpZXcgPSBuZXcgd3BhYS52aWV3LlJvd1ZpZXdNYW5hZ2Uoe1xuXHRcdFx0XHRcdG1vZGVsOm1vZGVsLFxuXHRcdFx0XHRcdGNvbnRyb2xsZXI6dGhpcyxcblx0XHRcdFx0fSk7XG5cdFx0XHR0aGlzLiRlbC5hcHBlbmQoIHZpZXcucmVuZGVyKCkuZWwgKTtcblx0XHRcdHRoaXMubGlzdGVuVG8oIG1vZGVsLCdkZXN0cm95JyxmdW5jdGlvbihlKXtcblx0XHRcdFx0dmlldy4kZWwucmVtb3ZlKCk7XG5cdFx0XHRcdHNlbGYuc2V0UGxhY2Vob2xkZXIoKTtcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5zZXRQbGFjZWhvbGRlcigpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRoYXNSb3c6ZnVuY3Rpb24obW9kZWwpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJCgnW2RhdGEtaWQ9XCInK21vZGVsLmdldCgnaWQnKSsnXCJdJykubGVuZ3RoID4gMDtcblx0XHR9LFxuXHRcdHJlbmRlcjogZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0aWYgKCAhIHRoaXMubW9kYWwgKSB7XG5cdFx0XHRcdHRoaXMubW9kYWwgPSBuZXcgd3BhYS52aWV3Lk1vZGFsTWFuYWdlKHtcblx0XHRcdFx0XHRjb250cm9sbGVyOlx0dGhpcyxcblx0XHRcdFx0fSApO1xuXHRcdFx0fVxuXG5cdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXG5cdFx0XHR0aGlzLiRwbGFjZWhvbGRlciA9IHRoaXMuJCgnLnBsYWNlaG9sZGVyLXJvdycpO1xuXG5cdFx0XHR0aGlzLnNldFBsYWNlaG9sZGVyKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHNldFBsYWNlaG9sZGVyOmZ1bmN0aW9uKCl7XG5cdFx0XHRpZiAoIHRoaXMuY29sbGVjdGlvbi5sZW5ndGggKSB7XG5cdFx0XHRcdHRoaXMuJHBsYWNlaG9sZGVyLnJlbW92ZSgpO1xuXHRcdFx0fSBlbHNlIGlmICggISB0aGlzLiRwbGFjZWhvbGRlci5wYXJlbnQoKS5sZW5ndGggKSB7XG5cdFx0XHRcdHRoaXMuJHBsYWNlaG9sZGVyLmFwcGVuZFRvKCB0aGlzLmVsICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXG5cdHdwYWEudmlldy5Nb2RhbE1hbmFnZSA9IHdwLm1lZGlhLnZpZXcuTW9kYWwuZXh0ZW5kKHtcblx0XHR0ZW1wbGF0ZTp3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtbW9kYWwnKSxcblx0XHRldmVudHM6XHRcdHtcblx0XHRcdCdjbGljayAubW9kYWwtY2xvc2UnXHQ6ICdjbG9zZScsXG5cdFx0XHQnY2xpY2sgI2J0bi1vaydcdFx0XHQ6ICdzYXZlJyxcblx0XHRcdCdrZXl1cCAjdGl0bGUtaW5wdXQnXHQ6ICdzZXRVSVN0YXRlJyxcblx0XHRcdCdjaGFuZ2UgI3RpdGxlLWlucHV0J1x0OiAnc2V0VUlTdGF0ZScsXG5cdFx0XHQnYmx1ciAjdGl0bGUtaW5wdXQnXHRcdDogJ3NldFVJU3RhdGUnLFxuXHRcdFx0J2tleXVwJ1x0XHRcdFx0XHQ6ICdvbmtleXVwJyxcblx0XHR9LFxuXHRcdHNldFVJU3RhdGU6ZnVuY3Rpb24oZSl7XG5cdFx0XHR0aGlzLiRva2F5LnByb3AoJ2Rpc2FibGVkJywhdGhpcy4kdGl0bGUudmFsKCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0d3AubWVkaWEudmlldy5Nb2RhbC5wcm90b3R5cGUucmVuZGVyLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcblx0XHRcdHRoaXMuJG9rYXkgPSB0aGlzLiQoJyNidG4tb2snKTtcblx0XHRcdHRoaXMuJHRpdGxlID0gdGhpcy4kKCcjdGl0bGUtaW5wdXQnKTtcblx0XHRcdHRoaXMuJHRpdGxlLnZhbCggdGhpcy5tb2RlbC5nZXQoICd0aXRsZScgKSApO1xuXHRcdFx0dGhpcy5zZXRVSVN0YXRlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdG9ua2V5dXA6ZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKCBlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSA9PT0gMjcgKSB7XG5cdFx0XHRcdHRoaXMuY2xvc2UoKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdG9wZW46ZnVuY3Rpb24oKXtcblx0XHRcdHdwLm1lZGlhLnZpZXcuTW9kYWwucHJvdG90eXBlLm9wZW4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xuXHRcdFx0dGhpcy4kKCcudGl0bGUnKS50ZXh0KCAhISB0aGlzLm1vZGVsLmdldCgnaWQnKSA/IGwxMG4uZWRpdEFjY2Vzc0FyZWEgOiBsMTBuLmNyZWF0ZUFjY2Vzc0FyZWEgKTtcblx0XHRcdHRoaXMuc2V0VUlTdGF0ZSgpO1xuXHRcdH0sXG5cdFx0c2F2ZTpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy5tb2RlbC5zZXQoJ3RpdGxlJywgdGhpcy4kdGl0bGUudmFsKCkgKTtcblx0XHRcdHRoaXMubW9kZWwuc2F2ZSggbnVsbCwge1xuXHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0XHRcdC8vIGFkZCBtZXNzYWdlXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGVycm9yOiBmdW5jdGlvbihlLHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0dmFyIG1vZGVsID0gbmV3IEJhY2tib25lLk1vZGVsKHJlc3BvbnNlLnJlc3BvbnNlSlNPTiksXG5cdFx0XHRcdFx0XHRub3RpY2UgPSBuZXcgd3AuYWNjZXNzQXJlYXMudmlldy5Ob3RpY2Uoe1xuXHRcdFx0XHRcdFx0XHRtb2RlbDogbW9kZWxcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdG1vZGVsLnNldCgnZGlzbWlzc2libGUnLHRydWUpO1xuXHRcdFx0XHRcdG1vZGVsLnNldCgndHlwZScsJ2Vycm9yJyk7XG5cdFx0XHRcdFx0Ly8gcHJpbnQgbWVzc2FnZVxuXHRcdFx0XHRcdC8vdGhpcy4kKCcubm90aWNlJykucmVtb3ZlKCk7XG5cdFx0XHRcdFx0bm90aWNlLnJlbmRlcigpLiRlbC5wcmVwZW5kVG8odGhpcy4kKCcubW9kYWwtY29udGVudCcpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblx0fSk7XG5cblx0d3BhYS52aWV3Lk1vZGFsQXNzaWduID0gd3AubWVkaWEudmlldy5Nb2RhbC5leHRlbmQoe1xuXHRcdHRlbXBsYXRlOndwLnRlbXBsYXRlKCdhY2Nlc3MtYXJlYS1hc3NpZ24tbW9kYWwnKSxcblx0XHRldmVudHM6XHRcdHtcblx0XHRcdCdjbGljayAubW9kYWwtY2xvc2UnXHQ6ICdjbG9zZScsXG5cdFx0XHQnY2xpY2sgI2J0bi1vaydcdFx0XHQ6ICdzYXZlJyxcblx0XHRcdCdjaGFuZ2Ugc2VsZWN0J1x0XHRcdDogJ3NldFVJU3RhdGUnLFxuXHRcdFx0J2tleXVwJ1x0XHRcdFx0XHQ6ICdvbmtleXVwJyxcblx0XHR9LFxuXHRcdG9ua2V5dXA6ZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKCBlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSA9PT0gMjcgKSB7XG5cdFx0XHRcdHRoaXMuY2xvc2UoKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHdwLm1lZGlhLnZpZXcuTW9kYWwucHJvdG90eXBlLnJlbmRlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG5cdFx0XHR0aGlzLiRva2F5ID0gdGhpcy4kKCcjYnRuLW9rJyk7XG5cdFx0XHR0aGlzLnNldFVJU3RhdGUoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0b3BlbjpmdW5jdGlvbigpe1xuXHRcdFx0d3AubWVkaWEudmlldy5Nb2RhbC5wcm90b3R5cGUub3Blbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG5cdFx0XHR0aGlzLiQoJy50aXRsZScpLnRleHQoIHRoaXMubW9kZWwuZ2V0KCdhY3Rpb24nKSA9PT0gJ2dyYW50JyA/IGwxMG4uZ3JhbnRBY2Nlc3MgOiBsMTBuLnJldm9rZUFjY2VzcyApO1xuXHRcdFx0dGhpcy4kKCdzZWxlY3QnKS52YWwoJycpXG5cdFx0XHR0aGlzLnNldFVJU3RhdGUoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0c2V0VUlTdGF0ZTpmdW5jdGlvbihlKXtcblx0XHRcdGNvbnNvbGUubG9nKHRoaXMuJCgnc2VsZWN0JykudmFsKCkpO1xuXHRcdFx0dGhpcy4kb2theS5wcm9wKCdkaXNhYmxlZCcsdGhpcy4kKCdzZWxlY3QnKS52YWwoKT09PScnKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0c2F2ZTpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy5tb2RlbC5zZXQoJ2lkJyx0aGlzLiQoJ3NlbGVjdCcpLnZhbCgpKTtcblx0XHRcdHRoaXMubW9kZWwuc2F2ZSggbnVsbCwge1xuXHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbihlLHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0dmFyIGFjdGlvbiA9IHNlbGYubW9kZWwuZ2V0KCdhY3Rpb24nKTtcblx0XHRcdFx0XHRfLmVhY2gocmVzcG9uc2UudXNlcl9pZCxmdW5jdGlvbih1c2VyX2lkLGkpe1xuXHRcdFx0XHRcdFx0aWYgKCAnZ3JhbnQnID09PSBhY3Rpb24gKSB7XG5cdFx0XHRcdFx0XHRcdHZhciAkYm94ID0gJCgnLmFzc2lnbi1hY2Nlc3MtYXJlYXNbZGF0YS13cGFhLXVzZXI9XCInICsgdXNlcl9pZCArICdcIl0nKSxcblx0XHRcdFx0XHRcdFx0XHRodG1sID0gd3AudGVtcGxhdGUoJ2FjY2Vzcy1hcmVhLWFzc2lnbmVkLXVzZXInKSgkLmV4dGVuZChyZXNwb25zZS5hY2Nlc3NfYXJlYSx7XG5cdFx0XHRcdFx0XHRcdFx0XHR1c2VyX2lkOnJlc3BvbnNlLnVzZXJfaWQsXG5cdFx0XHRcdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHRcdFx0XHQkYm94LnByZXBlbmQoaHRtbCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKCAncmV2b2tlJyA9PT0gYWN0aW9uICkge1xuXHRcdFx0XHRcdFx0XHQkKCdbZGF0YS13cGFhLWFjY2Vzcy1hcmVhPVwiJytyZXNwb25zZS5hY2Nlc3NfYXJlYS5pZCsnXCJdW2RhdGEtd3BhYS11c2VyPVwiJyt1c2VyX2lkKydcIl0nKVxuXHRcdFx0XHRcdFx0XHRcdC5jbG9zZXN0KCcud3BhYS1hY2Nlc3MtYXJlYScpXG5cdFx0XHRcdFx0XHRcdFx0LnJlbW92ZSgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0XHRcdC8vIGFkZCBtZXNzYWdlXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGVycm9yOiBmdW5jdGlvbihlLHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0dmFyIG1vZGVsID0gbmV3IEJhY2tib25lLk1vZGVsKHJlc3BvbnNlLnJlc3BvbnNlSlNPTiksXG5cdFx0XHRcdFx0XHRub3RpY2UgPSBuZXcgd3AuYWNjZXNzQXJlYXMudmlldy5Ob3RpY2Uoe1xuXHRcdFx0XHRcdFx0XHRtb2RlbDogbW9kZWxcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdG1vZGVsLnNldCgnZGlzbWlzc2libGUnLHRydWUpO1xuXHRcdFx0XHRcdG1vZGVsLnNldCgndHlwZScsJ2Vycm9yJyk7XG5cdFx0XHRcdFx0Ly8gcHJpbnQgbWVzc2FnZVxuXHRcdFx0XHRcdC8vdGhpcy4kKCcubm90aWNlJykucmVtb3ZlKCk7XG5cdFx0XHRcdFx0bm90aWNlLnJlbmRlcigpLiRlbC5wcmVwZW5kVG8odGhpcy4kKCcubW9kYWwtY29udGVudCcpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH0pO1xuXG5cblxuXG5cdGV4cG9ydHMuYWNjZXNzQXJlYXMgPSB3cGFhO1xufSkoalF1ZXJ5LHdwKTtcbiIsIihmdW5jdGlvbigkLGV4cG9ydHMpe1xuXG5cdHZhciB3cGFhID0gZXhwb3J0cy5hY2Nlc3NBcmVhcztcblxuXG5cdCQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG5cdFx0dmFyICRlbCA9ICQoJy5hY2Nlc3MtYXJlYXMtbGlzdC10YWJsZScpO1xuXHRcdGlmICggJGVsLmxlbmd0aCApIHtcblx0XHRcdG5ldyB3cGFhLnZpZXcuVGFibGVWaWV3TWFuYWdlKHtcblx0XHRcdFx0ZWw6ICRlbC5nZXQoMClcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG5cbn0pKGpRdWVyeSx3cCk7XG4iLCIoZnVuY3Rpb24oJCxleHBvcnRzKXtcblxuXHR2YXIgd3BhYSA9IGV4cG9ydHMuYWNjZXNzQXJlYXMsXG5cdFx0bW9kZWwgPSBuZXcgd3BhYS5tb2RlbC5Bc3NpZ24oKSxcblx0XHRtb2RhbCA9IG5ldyB3cGFhLnZpZXcuTW9kYWxBc3NpZ24oe21vZGVsOm1vZGVsLHByb3BhZ2F0ZTpmYWxzZX0pO1xuXG5cblxuXHQkKGRvY3VtZW50KVxuXHRcdC5vbignY2xpY2snLCdib2R5LnVzZXJzLXBocCAuYnV0dG9uLmFjdGlvbicsZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgYWN0aW9uID0gJCh0aGlzKS5wcmV2KCdzZWxlY3QnKS52YWwoKSxcblx0XHRcdFx0dXNlcnMgPSBbXTtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGlmICggWyd3cGFhLWdyYW50Jywnd3BhYS1yZXZva2UnXS5pbmRleE9mKGFjdGlvbikgIT09IC0xICkge1xuXHRcdFx0XHQkKCdbbmFtZT1cInVzZXJzW11cIl06Y2hlY2tlZCcpLmVhY2goZnVuY3Rpb24oaSxlbCl7XG5cdFx0XHRcdFx0dXNlcnMucHVzaCgkKHRoaXMpLnZhbCgpKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0bW9kZWwuc2V0KCdhY3Rpb24nLCBhY3Rpb24ucmVwbGFjZSgnd3BhYS0nLCcnKSk7XG5cdFx0XHRcdG1vZGVsLnNldCgndXNlcl9pZCcsIHVzZXJzICk7XG5cdFx0XHRcdG1vZGFsLm9wZW4oKTtcblx0XHRcdH1cblx0XHR9KVxuXHRcdC5vbignY2xpY2snLCdbZGF0YS13cGFhLWFjdGlvbl0nLGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdHZhciBhY3Rpb24gPSAkKHRoaXMpLmF0dHIoJ2RhdGEtd3BhYS1hY3Rpb24nKSxcblx0XHRcdFx0c2VsZiA9IHRoaXM7XG5cblx0XHRcdG1vZGVsLnNldCgnYWN0aW9uJywgYWN0aW9uICk7XG5cdFx0XHRtb2RlbC5zZXQoJ3VzZXJfaWQnLCAkKHRoaXMpLmF0dHIoJ2RhdGEtd3BhYS11c2VyJykgKTtcblxuXHRcdFx0aWYgKCBhY3Rpb24gPT09ICdyZXZva2UnICkge1xuXHRcdFx0XHRtb2RlbC5zZXQoICdpZCcsICQodGhpcykuYXR0cignZGF0YS13cGFhLWFjY2Vzcy1hcmVhJykgKTtcblx0XHRcdFx0bW9kZWwuc2F2ZShudWxsLHtcblx0XHRcdFx0XHRzdWNjZXNzOmZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHQkKHNlbGYpLmNsb3Nlc3QoJy53cGFhLWFjY2Vzcy1hcmVhJykucmVtb3ZlKCk7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRlcnJvcjpmdW5jdGlvbihlLHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHR2YXIgbW9kZWwgPSBuZXcgQmFja2JvbmUuTW9kZWwocmVzcG9uc2UucmVzcG9uc2VKU09OKSxcblx0XHRcdFx0XHRcdFx0bm90aWNlID0gbmV3IHdwLmFjY2Vzc0FyZWFzLnZpZXcuTm90aWNlKHtcblx0XHRcdFx0XHRcdFx0XHRtb2RlbDogbW9kZWxcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRtb2RlbC5zZXQoJ2Rpc21pc3NpYmxlJyx0cnVlKTtcblx0XHRcdFx0XHRcdG1vZGVsLnNldCgndHlwZScsJ2Vycm9yJyk7XG5cdFx0XHRcdFx0XHQvLyBwcmludCBtZXNzYWdlXG5cdFx0XHRcdFx0XHQvL3RoaXMuJCgnLm5vdGljZScpLnJlbW92ZSgpO1xuXHRcdFx0XHRcdFx0bm90aWNlLnJlbmRlcigpLiRlbC5pbnNlcnRmdGVyKCQoJy53cC1oZWFkZXItZW5kJykpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKCBhY3Rpb24gPT09ICdncmFudCcgKSB7XG5cdFx0XHRcdG1vZGFsLm9wZW4oKTtcblx0XHRcdH1cblx0XHR9KVxuXHRcdC8vIC5vbignY2xpY2snLCdbZGF0YS13cGFhLWFjdGlvbl0nLGZ1bmN0aW9uKGUpe1xuXHRcdC8vIFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAvL1xuXHRcdC8vIH0pXG5cdFx0O1xuXG5cbn0pKGpRdWVyeSx3cCk7XG4iXX0=
