!function(o,e){var t=access_areas_admin.l10n,s=access_areas_admin.options,i={l10n:t,view:{},model:{}};i.model.Assign=Backbone.Model.extend({defaults:{id:null,action:"grant",users:[]},save:function(){this.url=wpApiSettings.root+wpApiSettings.versionString+"access-area/"+this.get("id")+"/"+this.get("action"),Backbone.Model.prototype.save.apply(this,arguments)}}),i.view.Notice=wp.media.View.extend({template:wp.template("access-area-notice"),events:{"click .notice-dismiss":function(){this.$el.remove()}}}),i.view.RowViewManage=wp.media.View.extend({template:wp.template("access-area-row"),tagName:"tr",events:{"click a.delete":"delete","click a.edit":"edit"},initialize:function(){wp.media.View.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"before_sync",this.disable),this.listenTo(this.model,"before_destroy",this.disable),this.listenTo(this.model,"sync",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return wp.media.View.prototype.render.apply(this,arguments),this.$el.attr("data-id",this.model.get("id")),this.$el.find(".access-areas-scope").text(parseInt(this.model.get("blog_id"))?t.thisBlogOnly:t.entireNetwork),this},disable:function(e){return this.$el.addClass("disabled"),this},enable:function(e){return this.$el.removeClass("disabled"),this},delete:function(e){return e.preventDefault(),this.model.destroy(),this},edit:function(e){return this.controller.editEntry(this.model),this},delete:function(e){return this.model.destroy(),this}}),i.view.TableViewManage=wp.media.View.extend({events:{"click .add":"newEntry"},initialize:function(){var t=this;wp.media.View.prototype.initialize.apply(this,arguments),this.collection=new wp.api.collections.AccessArea,this.collection.fetch({data:{blog_id:s.current_blog_id}}),this.collection.once("sync",this.render,this),this.listenTo(this.collection,"add",function(e){t.addRow(e),console.log(arguments)}),this.listenTo(this.collection,"remove",function(e){t.setPlaceholder()}),this.render()},newEntry:function(e){var t=new wp.api.models.AccessArea({ID:null,title:""});return this.editEntry(t),this},editEntry:function(t){var s=this;return this.modal.model=t,this.modal.render().open({}),this.listenTo(t,"sync",function(e){s.stopListening(t,"sync"),s.collection.where({id:t.get("id")}).length||s.collection.add(t)}),this},addRow:function(e){var t=this,s=new i.view.RowViewManage({model:e,controller:this});return this.$el.append(s.render().el),this.listenTo(e,"destroy",function(e){s.$el.remove(),t.setPlaceholder()}),this.setPlaceholder(),this},hasRow:function(e){return 0<this.$('[data-id="'+e.get("id")+'"]').length},render:function(){return this.modal||(this.modal=new i.view.ModalManage({controller:this})),wp.media.View.prototype.render.apply(this,arguments),this.$placeholder=this.$(".placeholder-row"),this.setPlaceholder(),this},setPlaceholder:function(){this.collection.length?this.$placeholder.remove():this.$placeholder.parent().length||this.$placeholder.appendTo(this.el)}}),i.view.ModalManage=wp.media.view.Modal.extend({template:wp.template("access-area-modal"),events:{"click .modal-close":"close","click #btn-ok":"save","keyup #title-input":"setUIState","change #title-input":"setUIState","blur #title-input":"setUIState",keyup:"onkeyup"},setUIState:function(e){return this.$okay.prop("disabled",!this.$title.val()),this},render:function(){return wp.media.view.Modal.prototype.render.apply(this,arguments),this.$okay=this.$("#btn-ok"),this.$title=this.$("#title-input"),this.$blog_id=this.$('[name="blog_id"]'),this.$title.val(this.model.get("title")),this.setUIState(),this},onkeyup:function(e){27===e.originalEvent.keyCode&&this.close()},open:function(){wp.media.view.Modal.prototype.open.apply(this,arguments),this.$(".title").text(this.model.get("id")?t.editAccessArea:t.createAccessArea),this.setUIState()},save:function(){var t=this;this.model.set("title",this.$title.val()),this.model.set("blog_id",this.$blog_id.val()),this.model.save(null,{success:function(e){t.close()},error:function(e,t){var s=new Backbone.Model(t.responseJSON),i=new wp.accessAreas.view.Notice({model:s});s.set("dismissible",!0),s.set("type","error"),i.render().$el.prependTo(this.$(".modal-content"))}})}}),i.view.ModalAssign=wp.media.view.Modal.extend({template:wp.template("access-area-assign-modal"),events:{"click .modal-close":"close","click #btn-ok":"save","change select":"setUIState",keyup:"onkeyup"},onkeyup:function(e){return 27===e.originalEvent.keyCode&&this.close(),this},render:function(){return wp.media.view.Modal.prototype.render.apply(this,arguments),this.$okay=this.$("#btn-ok"),this.setUIState(),this},open:function(){var e=this.$("select");return wp.media.view.Modal.prototype.open.apply(this,arguments),this.$(".title").text("grant"===this.model.get("action")?t.grantAccess:t.revokeAccess),e.val(""),o('[data-wpaa-access-area][data-wpaa-user="'+this.model.get("user_id")+'"]').each(function(){e.find("option").removeAttr("style"),e.find('[value="'+o(this).attr("data-wpaa-access-area")+'"]').css("display","none")}),this.setUIState(),this},setUIState:function(e){return console.log(this.$("select").val()),this.$okay.prop("disabled",""===this.$("select").val()),this},save:function(){var t=this;return this.model.set("id",this.$("select").val()),this.model.save(null,{success:function(e,a){var n=t.model.get("action");_.each(a.user_id,function(e,t){if("grant"===n){var s=o('.assign-access-areas[data-wpaa-user="'+e+'"]'),i=wp.template("access-area-assigned-user")(o.extend(a.access_area,{user_id:a.user_id}));s.prepend(i)}else"revoke"===n&&o('[data-wpaa-access-area="'+a.access_area.id+'"][data-wpaa-user="'+e+'"]').closest(".wpaa-access-area").remove()}),t.close()},error:function(e,t){var s=new Backbone.Model(t.responseJSON),i=new wp.accessAreas.view.Notice({model:s});s.set("dismissible",!0),s.set("type","error"),i.render().$el.prependTo(this.$(".modal-content"))}}),this}}),e.accessAreas=i}(jQuery,wp),function(t,e){var s=wp.accessAreas;t(document).ready(function(){var e=t(".access-areas-list-table");e.length&&new s.view.TableViewManage({el:e.get(0)})})}(jQuery),function(a,e){var t=wp.accessAreas,i=new t.model.Assign,n=new t.view.ModalAssign({model:i,propagate:!1});a(document).on("click","body.users-php .button.action",function(e){var t=a(this).prev("select").val(),s=[];e.preventDefault(),-1!==["wpaa-grant","wpaa-revoke"].indexOf(t)&&(a('[name="users[]"]:checked').each(function(e,t){s.push(a(this).val())}),i.set("action",t.replace("wpaa-","")),i.set("user_id",s),n.open())}).on("click","[data-wpaa-action]",function(e){e.preventDefault();var t=a(this).attr("data-wpaa-action"),s=this;i.set("action",t),i.set("user_id",a(this).attr("data-wpaa-user")),"revoke"===t?(a(this).closest(".wpaa-access-area").addClass("idle"),i.set("id",a(this).attr("data-wpaa-access-area")),i.save(null,{success:function(){a(s).closest(".wpaa-access-area").remove()},error:function(e,t){var s=new Backbone.Model(t.responseJSON),i=new wp.accessAreas.view.Notice({model:s});s.set("dismissible",!0),s.set("type","error"),i.render().$el.insertfter(a(".wp-header-end"))}})):"grant"===t&&n.open()})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJtYW5hZ2UuanMiLCJ1c2Vycy5qcyJdLCJuYW1lcyI6WyIkIiwiZXhwb3J0cyIsImwxMG4iLCJhY2Nlc3NfYXJlYXNfYWRtaW4iLCJvcHRpb25zIiwid3BhYSIsInZpZXciLCJtb2RlbCIsIkFzc2lnbiIsIkJhY2tib25lIiwiTW9kZWwiLCJleHRlbmQiLCJkZWZhdWx0cyIsImlkIiwiYWN0aW9uIiwidXNlcnMiLCJzYXZlIiwidGhpcyIsInVybCIsIndwQXBpU2V0dGluZ3MiLCJyb290IiwidmVyc2lvblN0cmluZyIsImdldCIsInByb3RvdHlwZSIsImFwcGx5IiwiYXJndW1lbnRzIiwiTm90aWNlIiwid3AiLCJtZWRpYSIsIlZpZXciLCJ0ZW1wbGF0ZSIsImV2ZW50cyIsImNsaWNrIC5ub3RpY2UtZGlzbWlzcyIsIiRlbCIsInJlbW92ZSIsIlJvd1ZpZXdNYW5hZ2UiLCJ0YWdOYW1lIiwiY2xpY2sgYS5kZWxldGUiLCJjbGljayBhLmVkaXQiLCJpbml0aWFsaXplIiwibGlzdGVuVG8iLCJkaXNhYmxlIiwicmVuZGVyIiwiYXR0ciIsImZpbmQiLCJ0ZXh0IiwicGFyc2VJbnQiLCJ0aGlzQmxvZ09ubHkiLCJlbnRpcmVOZXR3b3JrIiwiZSIsImFkZENsYXNzIiwiZW5hYmxlIiwicmVtb3ZlQ2xhc3MiLCJkZWxldGUiLCJwcmV2ZW50RGVmYXVsdCIsImRlc3Ryb3kiLCJlZGl0IiwiY29udHJvbGxlciIsImVkaXRFbnRyeSIsIlRhYmxlVmlld01hbmFnZSIsImNsaWNrIC5hZGQiLCJzZWxmIiwiY29sbGVjdGlvbiIsImFwaSIsImNvbGxlY3Rpb25zIiwiQWNjZXNzQXJlYSIsImZldGNoIiwiZGF0YSIsImJsb2dfaWQiLCJjdXJyZW50X2Jsb2dfaWQiLCJvbmNlIiwiYWRkUm93IiwiY29uc29sZSIsImxvZyIsInNldFBsYWNlaG9sZGVyIiwibmV3RW50cnkiLCJtb2RlbHMiLCJJRCIsInRpdGxlIiwibW9kYWwiLCJvcGVuIiwic3RvcExpc3RlbmluZyIsIndoZXJlIiwibGVuZ3RoIiwiYWRkIiwiYXBwZW5kIiwiZWwiLCJoYXNSb3ciLCJNb2RhbE1hbmFnZSIsIiRwbGFjZWhvbGRlciIsInBhcmVudCIsImFwcGVuZFRvIiwiTW9kYWwiLCJjbGljayAubW9kYWwtY2xvc2UiLCJjbGljayAjYnRuLW9rIiwia2V5dXAgI3RpdGxlLWlucHV0IiwiY2hhbmdlICN0aXRsZS1pbnB1dCIsImJsdXIgI3RpdGxlLWlucHV0Iiwia2V5dXAiLCJzZXRVSVN0YXRlIiwiJG9rYXkiLCJwcm9wIiwiJHRpdGxlIiwidmFsIiwiJGJsb2dfaWQiLCJvbmtleXVwIiwib3JpZ2luYWxFdmVudCIsImtleUNvZGUiLCJjbG9zZSIsImVkaXRBY2Nlc3NBcmVhIiwiY3JlYXRlQWNjZXNzQXJlYSIsInNldCIsInN1Y2Nlc3MiLCJlcnJvciIsInJlc3BvbnNlIiwicmVzcG9uc2VKU09OIiwibm90aWNlIiwiYWNjZXNzQXJlYXMiLCJwcmVwZW5kVG8iLCJNb2RhbEFzc2lnbiIsImNoYW5nZSBzZWxlY3QiLCIkc2VsZWN0IiwiZ3JhbnRBY2Nlc3MiLCJyZXZva2VBY2Nlc3MiLCJlYWNoIiwicmVtb3ZlQXR0ciIsImNzcyIsIl8iLCJ1c2VyX2lkIiwiaSIsIiRib3giLCJodG1sIiwiYWNjZXNzX2FyZWEiLCJwcmVwZW5kIiwiY2xvc2VzdCIsImpRdWVyeSIsImRvY3VtZW50IiwicmVhZHkiLCJwcm9wYWdhdGUiLCJvbiIsInByZXYiLCJpbmRleE9mIiwicHVzaCIsInJlcGxhY2UiLCJpbnNlcnRmdGVyIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQWdCQSxJQUFBQyxFQUFBQyxtQkFBQUQsS0FDQUUsRUFBQUQsbUJBQUFDLFFBQ0FDLEVBQUEsQ0FDQUgsS0FBQUEsRUFDQUksS0FBQSxHQUNBQyxNQUFBLElBR0FGLEVBQUFFLE1BQUFDLE9BQUFDLFNBQUFDLE1BQUFDLE9BQUEsQ0FDQUMsU0FBQSxDQUNBQyxHQUFBLEtBQ0FDLE9BQUEsUUFDQUMsTUFBQSxJQUVBQyxL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LENBQ0FuQixNQUFBQSxJQUVBQSxFQUFBd0csSUFBQSxlQUFBLEdBQ0F4RyxFQUFBd0csSUFBQSxPQUFBLFNBR0FLLEVBQUExRSxTQUFBVCxJQUFBK0csV0FBQWhKLEVBQUEsdUJBR0EsVUFBQWMsR0FDQWlFLEVBQUFDLFNBckRBLENBK0RBdUQiLCJmaWxlIjoiYWNjZXNzLWFyZWFzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigkLGV4cG9ydHMpe1xuXHQvLyB3cEFwaVNldHRpbmdzLm1hcHBpbmcgPSB7XG5cdC8vIFx0bW9kZWxzOiB7XG5cdC8vIFx0XHQnQWNjZXNzQXJlYXMnIDogJ0FjY2Vzc0FyZWEnXG5cdC8vIFx0fSxcblx0Ly8gXHRjb2xsZWN0aW9uczp7fVxuXHQvLyB9O1xuXHQvLyB3cC5hcGkuaW5pdCh7XG5cdC8vIFx0dmVyc2lvblN0cmluZyA6ICd3cGFhL3YxLycsXG5cdC8vIFx0YXBpUm9vdDogd3BBcGlTZXR0aW5ncy5yb290LFxuXHQvLyBcdHNjaGVtYTogbnVsbCxcblx0Ly8gXHR9KVxuXHQvLyBcdC5kb25lKCBmdW5jdGlvbigpIHtcblx0Ly8gXHRcdGNvbnNvbGUubG9nKHRoaXMsIHdwLmFwaS5lbmRwb2ludHMuZmluZCh7dmVyc2lvblN0cmluZzond3BhYS92MS8nfSkgKTtcblx0Ly8gXHR9KTtcblxuXHR2YXIgbDEwbiA9IGFjY2Vzc19hcmVhc19hZG1pbi5sMTBuLFxuXHRcdG9wdGlvbnMgPSBhY2Nlc3NfYXJlYXNfYWRtaW4ub3B0aW9ucyxcblx0XHR3cGFhID0ge1xuXHRcdFx0bDEwbjogbDEwbixcblx0XHRcdHZpZXc6IHt9LFxuXHRcdFx0bW9kZWw6IHt9XG5cdFx0fTtcblxuXHR3cGFhLm1vZGVsLkFzc2lnbiA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG5cdFx0ZGVmYXVsdHM6e1xuXHRcdFx0aWQ6IG51bGwsXG5cdFx0XHRhY3Rpb246J2dyYW50Jyxcblx0XHRcdHVzZXJzOltdXG5cdFx0fSxcblx0XHRzYXZlOmZ1bmN0aW9uKCkge1xuXG5cdFx0XHR0aGlzLnVybCA9IHdwQXBpU2V0dGluZ3Mucm9vdCArIHdwQXBpU2V0dGluZ3MudmVyc2lvblN0cmluZyArICdhY2Nlc3MtYXJlYS8nICsgdGhpcy5nZXQoJ2lkJykgKyAnLycgKyB0aGlzLmdldCgnYWN0aW9uJyk7XG5cdFx0XHRCYWNrYm9uZS5Nb2RlbC5wcm90b3R5cGUuc2F2ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cblx0XHR9XG5cdH0pO1xuXG5cdHdwYWEudmlldy5Ob3RpY2UgPSB3cC5tZWRpYS5WaWV3LmV4dGVuZCh7XG5cdFx0dGVtcGxhdGU6IHdwLnRlbXBsYXRlKCdhY2Nlc3MtYXJlYS1ub3RpY2UnKSxcblx0XHRldmVudHM6e1xuXHRcdFx0J2NsaWNrIC5ub3RpY2UtZGlzbWlzcycgOiBmdW5jdGlvbigpe1xuXHRcdFx0XHR0aGlzLiRlbC5yZW1vdmUoKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdHdwYWEudmlldy5Sb3dWaWV3TWFuYWdlID0gd3AubWVkaWEuVmlldy5leHRlbmQoe1xuXHRcdHRlbXBsYXRlOndwLnRlbXBsYXRlKCdhY2Nlc3MtYXJlYS1yb3cnKSxcblx0XHR0YWdOYW1lOid0cicsXG5cdFx0ZXZlbnRzOiB7XG5cdFx0XHQnY2xpY2sgYS5kZWxldGUnXHRcdDogJ2RlbGV0ZScsXG5cdFx0XHQnY2xpY2sgYS5lZGl0J1x0XHRcdDogJ2VkaXQnLFxuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5pbml0aWFsaXplLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMubW9kZWwsICdiZWZvcmVfc3luYycsIHRoaXMuZGlzYWJsZSApO1xuXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy5tb2RlbCwgJ2JlZm9yZV9kZXN0cm95JywgdGhpcy5kaXNhYmxlICk7XG5cdFx0XHR0aGlzLmxpc3RlblRvKCB0aGlzLm1vZGVsLCAnc3luYycsIHRoaXMucmVuZGVyICk7XG5cdFx0XHR0aGlzLmxpc3RlblRvKCB0aGlzLm1vZGVsLCAnZGVzdHJveScsIHRoaXMucmVtb3ZlICk7XG5cdFx0fSxcblx0XHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0d3AubWVkaWEuVmlldy5wcm90b3R5cGUucmVuZGVyLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHRcdHRoaXMuJGVsLmF0dHIoJ2RhdGEtaWQnLHRoaXMubW9kZWwuZ2V0KCdpZCcpKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJy5hY2Nlc3MtYXJlYXMtc2NvcGUnKS50ZXh0KCBwYXJzZUludCggdGhpcy5tb2RlbC5nZXQoJ2Jsb2dfaWQnKSApID8gbDEwbi50aGlzQmxvZ09ubHkgOiBsMTBuLmVudGlyZU5ldHdvcmsgKVxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRkaXNhYmxlOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kZWwuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGVuYWJsZTpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMuJGVsLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRkZWxldGU6ZnVuY3Rpb24oZSl7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR0aGlzLm1vZGVsLmRlc3Ryb3koKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0ZWRpdDpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMuY29udHJvbGxlci5lZGl0RW50cnkodGhpcy5tb2RlbCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGRlbGV0ZTpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMubW9kZWwuZGVzdHJveSgpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9KTtcblx0d3BhYS52aWV3LlRhYmxlVmlld01hbmFnZSA9IHdwLm1lZGlhLlZpZXcuZXh0ZW5kKHtcblx0XHRldmVudHM6IHtcblx0XHRcdCdjbGljayAuYWRkJyA6ICduZXdFbnRyeScsXG5cdFx0fSxcblx0XHRpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXHRcdFx0dGhpcy5jb2xsZWN0aW9uID0gbmV3IHdwLmFwaS5jb2xsZWN0aW9ucy5BY2Nlc3NBcmVhKCk7XG5cdFx0XHR0aGlzLmNvbGxlY3Rpb24uZmV0Y2goIHsgZGF0YTogeyBibG9nX2lkOiBvcHRpb25zLmN1cnJlbnRfYmxvZ19pZCB9IH0gKTtcblx0XHRcdHRoaXMuY29sbGVjdGlvbi5vbmNlKCdzeW5jJyx0aGlzLnJlbmRlcix0aGlzKTtcblx0XHRcdHRoaXMubGlzdGVuVG8odGhpcy5jb2xsZWN0aW9uLCdhZGQnLGZ1bmN0aW9uKG1vZGVsKXtcblx0XHRcdFx0c2VsZi5hZGRSb3cobW9kZWwpO1xuXHRcdFx0XHRjb25zb2xlLmxvZyhhcmd1bWVudHMpO1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLmxpc3RlblRvKHRoaXMuY29sbGVjdGlvbiwncmVtb3ZlJyxmdW5jdGlvbihtb2RlbCl7XG5cdFx0XHRcdHNlbGYuc2V0UGxhY2Vob2xkZXIoKTtcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5yZW5kZXIoKTtcblx0XHR9LFxuXHRcdG5ld0VudHJ5OmZ1bmN0aW9uKGUpIHtcblx0XHRcdHZhciBtb2RlbCA9IG5ldyB3cC5hcGkubW9kZWxzLkFjY2Vzc0FyZWEoe1xuXHRcdFx0XHRcdElEOiBudWxsLFxuXHRcdFx0XHRcdHRpdGxlOiAnJyxcblx0XHRcdFx0fSk7XG5cdFx0XHR0aGlzLmVkaXRFbnRyeShtb2RlbCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGVkaXRFbnRyeTpmdW5jdGlvbihtb2RlbCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0Ly8gb3BlbiBtb2RhbFxuXHRcdFx0dGhpcy5tb2RhbC5tb2RlbCA9IG1vZGVsO1xuXHRcdFx0dGhpcy5tb2RhbC5yZW5kZXIoKS5vcGVuKHt9KTtcblx0XHRcdHRoaXMubGlzdGVuVG8obW9kZWwsJ3N5bmMnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnN0b3BMaXN0ZW5pbmcobW9kZWwsJ3N5bmMnKTtcblx0XHRcdFx0aWYgKCAhIHNlbGYuY29sbGVjdGlvbi53aGVyZSggeyBpZDogbW9kZWwuZ2V0KCdpZCcpIH0gKS5sZW5ndGggKSB7XG5cdFx0XHRcdFx0c2VsZi5jb2xsZWN0aW9uLmFkZChtb2RlbCk7XG4vL1x0XHRcdFx0XHRcdHNlbGYuYWRkUm93KG1vZGVsKTtcblxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0YWRkUm93OmZ1bmN0aW9uKCBtb2RlbCApe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHR2aWV3ID0gbmV3IHdwYWEudmlldy5Sb3dWaWV3TWFuYWdlKHtcblx0XHRcdFx0XHRtb2RlbDptb2RlbCxcblx0XHRcdFx0XHRjb250cm9sbGVyOnRoaXMsXG5cdFx0XHRcdH0pO1xuXHRcdFx0dGhpcy4kZWwuYXBwZW5kKCB2aWV3LnJlbmRlcigpLmVsICk7XG5cdFx0XHR0aGlzLmxpc3RlblRvKCBtb2RlbCwnZGVzdHJveScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHZpZXcuJGVsLnJlbW92ZSgpO1xuXHRcdFx0XHRzZWxmLnNldFBsYWNlaG9sZGVyKCk7XG5cdFx0XHR9KTtcblx0XHRcdHRoaXMuc2V0UGxhY2Vob2xkZXIoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0aGFzUm93OmZ1bmN0aW9uKG1vZGVsKXtcblx0XHRcdHJldHVybiB0aGlzLiQoJ1tkYXRhLWlkPVwiJyttb2RlbC5nZXQoJ2lkJykrJ1wiXScpLmxlbmd0aCA+IDA7XG5cdFx0fSxcblx0XHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmICggISB0aGlzLm1vZGFsICkge1xuXHRcdFx0XHR0aGlzLm1vZGFsID0gbmV3IHdwYWEudmlldy5Nb2RhbE1hbmFnZSh7XG5cdFx0XHRcdFx0Y29udHJvbGxlcjpcdHRoaXMsXG5cdFx0XHRcdH0gKTtcblx0XHRcdH1cblxuXHRcdFx0d3AubWVkaWEuVmlldy5wcm90b3R5cGUucmVuZGVyLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblxuXHRcdFx0dGhpcy4kcGxhY2Vob2xkZXIgPSB0aGlzLiQoJy5wbGFjZWhvbGRlci1yb3cnKTtcblxuXHRcdFx0dGhpcy5zZXRQbGFjZWhvbGRlcigpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRzZXRQbGFjZWhvbGRlcjpmdW5jdGlvbigpe1xuXHRcdFx0aWYgKCB0aGlzLmNvbGxlY3Rpb24ubGVuZ3RoICkge1xuXHRcdFx0XHR0aGlzLiRwbGFjZWhvbGRlci5yZW1vdmUoKTtcblx0XHRcdH0gZWxzZSBpZiAoICEgdGhpcy4kcGxhY2Vob2xkZXIucGFyZW50KCkubGVuZ3RoICkge1xuXHRcdFx0XHR0aGlzLiRwbGFjZWhvbGRlci5hcHBlbmRUbyggdGhpcy5lbCApO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG5cblxuXHR3cGFhLnZpZXcuTW9kYWxNYW5hZ2UgPSB3cC5tZWRpYS52aWV3Lk1vZGFsLmV4dGVuZCh7XG5cdFx0dGVtcGxhdGU6d3AudGVtcGxhdGUoJ2FjY2Vzcy1hcmVhLW1vZGFsJyksXG5cdFx0ZXZlbnRzOlx0XHR7XG5cdFx0XHQnY2xpY2sgLm1vZGFsLWNsb3NlJ1x0OiAnY2xvc2UnLFxuXHRcdFx0J2NsaWNrICNidG4tb2snXHRcdFx0OiAnc2F2ZScsXG5cdFx0XHQna2V5dXAgI3RpdGxlLWlucHV0J1x0OiAnc2V0VUlTdGF0ZScsXG5cdFx0XHQnY2hhbmdlICN0aXRsZS1pbnB1dCdcdDogJ3NldFVJU3RhdGUnLFxuXHRcdFx0J2JsdXIgI3RpdGxlLWlucHV0J1x0XHQ6ICdzZXRVSVN0YXRlJyxcblx0XHRcdCdrZXl1cCdcdFx0XHRcdFx0OiAnb25rZXl1cCcsXG5cdFx0fSxcblx0XHRzZXRVSVN0YXRlOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kb2theS5wcm9wKCdkaXNhYmxlZCcsIXRoaXMuJHRpdGxlLnZhbCgpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHdwLm1lZGlhLnZpZXcuTW9kYWwucHJvdG90eXBlLnJlbmRlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG5cdFx0XHR0aGlzLiRva2F5ID0gdGhpcy4kKCcjYnRuLW9rJyk7XG5cdFx0XHR0aGlzLiR0aXRsZSA9IHRoaXMuJCgnI3RpdGxlLWlucHV0Jyk7XG5cdFx0XHR0aGlzLiRibG9nX2lkID0gdGhpcy4kKCdbbmFtZT1cImJsb2dfaWRcIl0nKTtcblx0XHRcdHRoaXMuJHRpdGxlLnZhbCggdGhpcy5tb2RlbC5nZXQoICd0aXRsZScgKSApO1xuXHRcdFx0dGhpcy5zZXRVSVN0YXRlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdG9ua2V5dXA6ZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKCBlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSA9PT0gMjcgKSB7XG5cdFx0XHRcdHRoaXMuY2xvc2UoKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdG9wZW46ZnVuY3Rpb24oKXtcblx0XHRcdHdwLm1lZGlhLnZpZXcuTW9kYWwucHJvdG90eXBlLm9wZW4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xuXHRcdFx0dGhpcy4kKCcudGl0bGUnKS50ZXh0KCAhISB0aGlzLm1vZGVsLmdldCgnaWQnKSA/IGwxMG4uZWRpdEFjY2Vzc0FyZWEgOiBsMTBuLmNyZWF0ZUFjY2Vzc0FyZWEgKTtcblx0XHRcdHRoaXMuc2V0VUlTdGF0ZSgpO1xuXHRcdH0sXG5cdFx0c2F2ZTpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy5tb2RlbC5zZXQoJ3RpdGxlJywgdGhpcy4kdGl0bGUudmFsKCkgKTtcblx0XHRcdHRoaXMubW9kZWwuc2V0KCdibG9nX2lkJywgdGhpcy4kYmxvZ19pZC52YWwoKSApO1xuXHRcdFx0dGhpcy5tb2RlbC5zYXZlKCBudWxsLCB7XG5cdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRzZWxmLmNsb3NlKCk7XG5cdFx0XHRcdFx0Ly8gYWRkIG1lc3NhZ2Vcblx0XHRcdFx0fSxcblx0XHRcdFx0ZXJyb3I6IGZ1bmN0aW9uKGUscmVzcG9uc2UpIHtcblx0XHRcdFx0XHR2YXIgbW9kZWwgPSBuZXcgQmFja2JvbmUuTW9kZWwocmVzcG9uc2UucmVzcG9uc2VKU09OKSxcblx0XHRcdFx0XHRcdG5vdGljZSA9IG5ldyB3cC5hY2Nlc3NBcmVhcy52aWV3Lk5vdGljZSh7XG5cdFx0XHRcdFx0XHRcdG1vZGVsOiBtb2RlbFxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0bW9kZWwuc2V0KCdkaXNtaXNzaWJsZScsdHJ1ZSk7XG5cdFx0XHRcdFx0bW9kZWwuc2V0KCd0eXBlJywnZXJyb3InKTtcblx0XHRcdFx0XHQvLyBwcmludCBtZXNzYWdlXG5cdFx0XHRcdFx0Ly90aGlzLiQoJy5ub3RpY2UnKS5yZW1vdmUoKTtcblx0XHRcdFx0XHRub3RpY2UucmVuZGVyKCkuJGVsLnByZXBlbmRUbyh0aGlzLiQoJy5tb2RhbC1jb250ZW50JykpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXHR9KTtcblxuXHR3cGFhLnZpZXcuTW9kYWxBc3NpZ24gPSB3cC5tZWRpYS52aWV3Lk1vZGFsLmV4dGVuZCh7XG5cdFx0dGVtcGxhdGU6d3AudGVtcGxhdGUoJ2FjY2Vzcy1hcmVhLWFzc2lnbi1tb2RhbCcpLFxuXHRcdGV2ZW50czpcdFx0e1xuXHRcdFx0J2NsaWNrIC5tb2RhbC1jbG9zZSdcdDogJ2Nsb3NlJyxcblx0XHRcdCdjbGljayAjYnRuLW9rJ1x0XHRcdDogJ3NhdmUnLFxuXHRcdFx0J2NoYW5nZSBzZWxlY3QnXHRcdFx0OiAnc2V0VUlTdGF0ZScsXG5cdFx0XHQna2V5dXAnXHRcdFx0XHRcdDogJ29ua2V5dXAnLFxuXHRcdH0sXG5cdFx0b25rZXl1cDpmdW5jdGlvbihlKSB7XG5cdFx0XHRpZiAoIGUub3JpZ2luYWxFdmVudC5rZXlDb2RlID09PSAyNyApIHtcblx0XHRcdFx0dGhpcy5jbG9zZSgpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0d3AubWVkaWEudmlldy5Nb2RhbC5wcm90b3R5cGUucmVuZGVyLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcblx0XHRcdHRoaXMuJG9rYXkgPSB0aGlzLiQoJyNidG4tb2snKTtcblx0XHRcdHRoaXMuc2V0VUlTdGF0ZSgpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRvcGVuOmZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdCRzZWxlY3QgPSB0aGlzLiQoJ3NlbGVjdCcpO1xuXHRcdFx0d3AubWVkaWEudmlldy5Nb2RhbC5wcm90b3R5cGUub3Blbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG5cdFx0XHR0aGlzLiQoJy50aXRsZScpLnRleHQoIHRoaXMubW9kZWwuZ2V0KCdhY3Rpb24nKSA9PT0gJ2dyYW50JyA/IGwxMG4uZ3JhbnRBY2Nlc3MgOiBsMTBuLnJldm9rZUFjY2VzcyApO1xuXHRcdFx0JHNlbGVjdC52YWwoJycpO1xuXG5cdFx0XHQkKCdbZGF0YS13cGFhLWFjY2Vzcy1hcmVhXVtkYXRhLXdwYWEtdXNlcj1cIicrdGhpcy5tb2RlbC5nZXQoJ3VzZXJfaWQnKSsnXCJdJykuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHQkc2VsZWN0LmZpbmQoJ29wdGlvbicpLnJlbW92ZUF0dHIoJ3N0eWxlJyk7XG5cdFx0XHRcdCRzZWxlY3QuZmluZCgnW3ZhbHVlPVwiJyskKHRoaXMpLmF0dHIoJ2RhdGEtd3BhYS1hY2Nlc3MtYXJlYScpKydcIl0nKS5jc3MoJ2Rpc3BsYXknLCdub25lJyk7XG5cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLnNldFVJU3RhdGUoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0c2V0VUlTdGF0ZTpmdW5jdGlvbihlKXtcblx0XHRcdGNvbnNvbGUubG9nKHRoaXMuJCgnc2VsZWN0JykudmFsKCkpO1xuXHRcdFx0dGhpcy4kb2theS5wcm9wKCdkaXNhYmxlZCcsdGhpcy4kKCdzZWxlY3QnKS52YWwoKT09PScnKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0c2F2ZTpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy5tb2RlbC5zZXQoJ2lkJyx0aGlzLiQoJ3NlbGVjdCcpLnZhbCgpKTtcblx0XHRcdHRoaXMubW9kZWwuc2F2ZSggbnVsbCwge1xuXHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbihlLHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0dmFyIGFjdGlvbiA9IHNlbGYubW9kZWwuZ2V0KCdhY3Rpb24nKTtcblx0XHRcdFx0XHRfLmVhY2gocmVzcG9uc2UudXNlcl9pZCxmdW5jdGlvbih1c2VyX2lkLGkpe1xuXHRcdFx0XHRcdFx0aWYgKCAnZ3JhbnQnID09PSBhY3Rpb24gKSB7XG5cdFx0XHRcdFx0XHRcdHZhciAkYm94ID0gJCgnLmFzc2lnbi1hY2Nlc3MtYXJlYXNbZGF0YS13cGFhLXVzZXI9XCInICsgdXNlcl9pZCArICdcIl0nKSxcblx0XHRcdFx0XHRcdFx0XHRodG1sID0gd3AudGVtcGxhdGUoJ2FjY2Vzcy1hcmVhLWFzc2lnbmVkLXVzZXInKSgkLmV4dGVuZChyZXNwb25zZS5hY2Nlc3NfYXJlYSx7XG5cdFx0XHRcdFx0XHRcdFx0XHR1c2VyX2lkOnJlc3BvbnNlLnVzZXJfaWQsXG5cdFx0XHRcdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHRcdFx0XHQkYm94LnByZXBlbmQoaHRtbCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKCAncmV2b2tlJyA9PT0gYWN0aW9uICkge1xuXHRcdFx0XHRcdFx0XHQkKCdbZGF0YS13cGFhLWFjY2Vzcy1hcmVhPVwiJytyZXNwb25zZS5hY2Nlc3NfYXJlYS5pZCsnXCJdW2RhdGEtd3BhYS11c2VyPVwiJyt1c2VyX2lkKydcIl0nKVxuXHRcdFx0XHRcdFx0XHRcdC5jbG9zZXN0KCcud3BhYS1hY2Nlc3MtYXJlYScpXG5cdFx0XHRcdFx0XHRcdFx0LnJlbW92ZSgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0XHRcdC8vIGFkZCBtZXNzYWdlXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGVycm9yOiBmdW5jdGlvbihlLHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0dmFyIG1vZGVsID0gbmV3IEJhY2tib25lLk1vZGVsKHJlc3BvbnNlLnJlc3BvbnNlSlNPTiksXG5cdFx0XHRcdFx0XHRub3RpY2UgPSBuZXcgd3AuYWNjZXNzQXJlYXMudmlldy5Ob3RpY2Uoe1xuXHRcdFx0XHRcdFx0XHRtb2RlbDogbW9kZWxcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdG1vZGVsLnNldCgnZGlzbWlzc2libGUnLHRydWUpO1xuXHRcdFx0XHRcdG1vZGVsLnNldCgndHlwZScsJ2Vycm9yJyk7XG5cdFx0XHRcdFx0Ly8gcHJpbnQgbWVzc2FnZVxuXHRcdFx0XHRcdC8vdGhpcy4kKCcubm90aWNlJykucmVtb3ZlKCk7XG5cdFx0XHRcdFx0bm90aWNlLnJlbmRlcigpLiRlbC5wcmVwZW5kVG8odGhpcy4kKCcubW9kYWwtY29udGVudCcpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH0pO1xuXG5cblxuXG5cdGV4cG9ydHMuYWNjZXNzQXJlYXMgPSB3cGFhO1xufSkoalF1ZXJ5LHdwKTtcbiIsIihmdW5jdGlvbigkLGV4cG9ydHMpe1xuXG5cdHZhciB3cGFhID0gZXhwb3J0cy5hY2Nlc3NBcmVhcztcblxuXG5cdCQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG5cdFx0dmFyICRlbCA9ICQoJy5hY2Nlc3MtYXJlYXMtbGlzdC10YWJsZScpO1xuXHRcdGlmICggJGVsLmxlbmd0aCApIHtcblx0XHRcdG5ldyB3cGFhLnZpZXcuVGFibGVWaWV3TWFuYWdlKHtcblx0XHRcdFx0ZWw6ICRlbC5nZXQoMClcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG5cbn0pKGpRdWVyeSx3cCk7XG4iLCIoZnVuY3Rpb24oJCxleHBvcnRzKXtcblxuXHR2YXIgd3BhYSA9IGV4cG9ydHMuYWNjZXNzQXJlYXMsXG5cdFx0bW9kZWwgPSBuZXcgd3BhYS5tb2RlbC5Bc3NpZ24oKSxcblx0XHRtb2RhbCA9IG5ldyB3cGFhLnZpZXcuTW9kYWxBc3NpZ24oe21vZGVsOm1vZGVsLHByb3BhZ2F0ZTpmYWxzZX0pO1xuXG5cblxuXHQkKGRvY3VtZW50KVxuXHRcdC5vbignY2xpY2snLCdib2R5LnVzZXJzLXBocCAuYnV0dG9uLmFjdGlvbicsZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgYWN0aW9uID0gJCh0aGlzKS5wcmV2KCdzZWxlY3QnKS52YWwoKSxcblx0XHRcdFx0dXNlcnMgPSBbXTtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGlmICggWyd3cGFhLWdyYW50Jywnd3BhYS1yZXZva2UnXS5pbmRleE9mKGFjdGlvbikgIT09IC0xICkge1xuXHRcdFx0XHQkKCdbbmFtZT1cInVzZXJzW11cIl06Y2hlY2tlZCcpLmVhY2goZnVuY3Rpb24oaSxlbCl7XG5cdFx0XHRcdFx0dXNlcnMucHVzaCgkKHRoaXMpLnZhbCgpKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0bW9kZWwuc2V0KCdhY3Rpb24nLCBhY3Rpb24ucmVwbGFjZSgnd3BhYS0nLCcnKSk7XG5cdFx0XHRcdG1vZGVsLnNldCgndXNlcl9pZCcsIHVzZXJzICk7XG5cdFx0XHRcdG1vZGFsLm9wZW4oKTtcblx0XHRcdH1cblx0XHR9KVxuXHRcdC5vbignY2xpY2snLCdbZGF0YS13cGFhLWFjdGlvbl0nLGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdHZhciBhY3Rpb24gPSAkKHRoaXMpLmF0dHIoJ2RhdGEtd3BhYS1hY3Rpb24nKSxcblx0XHRcdFx0c2VsZiA9IHRoaXM7XG5cblx0XHRcdG1vZGVsLnNldCgnYWN0aW9uJywgYWN0aW9uICk7XG5cdFx0XHRtb2RlbC5zZXQoJ3VzZXJfaWQnLCAkKHRoaXMpLmF0dHIoJ2RhdGEtd3BhYS11c2VyJykgKTtcblxuXHRcdFx0aWYgKCBhY3Rpb24gPT09ICdyZXZva2UnICkge1xuXHRcdFx0XHQkKHRoaXMpLmNsb3Nlc3QoJy53cGFhLWFjY2Vzcy1hcmVhJykuYWRkQ2xhc3MoJ2lkbGUnKTtcblx0XHRcdFx0bW9kZWwuc2V0KCAnaWQnLCAkKHRoaXMpLmF0dHIoJ2RhdGEtd3BhYS1hY2Nlc3MtYXJlYScpICk7XG5cdFx0XHRcdG1vZGVsLnNhdmUobnVsbCx7XG5cdFx0XHRcdFx0c3VjY2VzczpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0JChzZWxmKS5jbG9zZXN0KCcud3BhYS1hY2Nlc3MtYXJlYScpLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0ZXJyb3I6ZnVuY3Rpb24oZSxyZXNwb25zZSkge1xuXHRcdFx0XHRcdFx0dmFyIG1vZGVsID0gbmV3IEJhY2tib25lLk1vZGVsKHJlc3BvbnNlLnJlc3BvbnNlSlNPTiksXG5cdFx0XHRcdFx0XHRcdG5vdGljZSA9IG5ldyB3cC5hY2Nlc3NBcmVhcy52aWV3Lk5vdGljZSh7XG5cdFx0XHRcdFx0XHRcdFx0bW9kZWw6IG1vZGVsXG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0bW9kZWwuc2V0KCdkaXNtaXNzaWJsZScsdHJ1ZSk7XG5cdFx0XHRcdFx0XHRtb2RlbC5zZXQoJ3R5cGUnLCdlcnJvcicpO1xuXHRcdFx0XHRcdFx0Ly8gcHJpbnQgbWVzc2FnZVxuXHRcdFx0XHRcdFx0Ly90aGlzLiQoJy5ub3RpY2UnKS5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdG5vdGljZS5yZW5kZXIoKS4kZWwuaW5zZXJ0ZnRlcigkKCcud3AtaGVhZGVyLWVuZCcpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICggYWN0aW9uID09PSAnZ3JhbnQnICkge1xuXHRcdFx0XHRtb2RhbC5vcGVuKCk7XG5cdFx0XHR9XG5cdFx0fSlcblx0XHQvLyAub24oJ2NsaWNrJywnW2RhdGEtd3BhYS1hY3Rpb25dJyxmdW5jdGlvbihlKXtcblx0XHQvLyBcdGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgLy9cblx0XHQvLyB9KVxuXHRcdDtcblxuXG59KShqUXVlcnksd3ApO1xuIl19
