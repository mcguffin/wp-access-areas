!function(e,t){var i=access_areas_admin.l10n,s={l10n:i,view:{},model:{}};s.model.Assign=Backbone.Model.extend({defaults:{id:null,action:"grant",users:[]},save:function(){this.url=wpApiSettings.root+wpApiSettings.versionString+"access-area/"+this.get("id")+"/"+this.get("action"),Backbone.Model.prototype.save.apply(this,arguments)}}),s.view.Notice=wp.media.View.extend({template:wp.template("access-area-notice"),events:{"click .notice-dismiss":function(){this.$el.remove()}}}),s.view.RowViewManage=wp.media.View.extend({template:wp.template("access-area-row"),tagName:"tr",events:{"click a.delete":"delete","click a.edit":"edit"},initialize:function(){wp.media.View.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"before_sync",this.disable),this.listenTo(this.model,"before_destroy",this.disable),this.listenTo(this.model,"sync",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return wp.media.View.prototype.render.apply(this,arguments),this.$el.attr("data-id",this.model.get("id")),this},disable:function(e){return this.$el.addClass("disabled"),this},enable:function(e){return this.$el.removeClass("disabled"),this},delete:function(e){return e.preventDefault(),this.model.destroy(),this},edit:function(e){return this.controller.editEntry(this.model),this},delete:function(e){return this.model.destroy(),this}}),s.view.TableViewManage=wp.media.View.extend({events:{"click .add":"newEntry"},initialize:function(){var e=this;wp.media.View.prototype.initialize.apply(this,arguments),this.collection=new wp.api.collections.AccessArea,this.collection.fetch(),this.collection.once("sync",this.render,this),this.listenTo(this.collection,"add",function(t){e.addRow(t),console.log(arguments)}),this.listenTo(this.collection,"remove",function(t){e.setPlaceholder()}),this.render()},newEntry:function(e){var t=new wp.api.models.AccessArea({ID:null,title:""});return this.editEntry(t),this},editEntry:function(e){var t=this;return this.modal.model=e,this.modal.render().open({}),this.listenTo(e,"sync",function(i){t.stopListening(e,"sync"),t.collection.where({id:e.get("id")}).length||t.collection.add(e)}),this},addRow:function(e){var t=this,i=new s.view.RowViewManage({model:e,controller:this});return this.$el.append(i.render().el),this.listenTo(e,"destroy",function(e){i.$el.remove(),t.setPlaceholder()}),this.setPlaceholder(),this},hasRow:function(e){return this.$('[data-id="'+e.get("id")+'"]').length>0},render:function(){return this.modal||(this.modal=new s.view.ModalManage({controller:this})),wp.media.View.prototype.render.apply(this,arguments),this.$placeholder=this.$(".placeholder-row"),this.setPlaceholder(),this},setPlaceholder:function(){this.collection.length?this.$placeholder.remove():this.$placeholder.parent().length||this.$placeholder.appendTo(this.el)}}),s.view.ModalManage=wp.media.view.Modal.extend({template:wp.template("access-area-modal"),events:{"click .modal-close":"close","click #btn-ok":"save","keyup #title-input":"setUIState","change #title-input":"setUIState","blur #title-input":"setUIState",keyup:"onkeyup"},setUIState:function(e){return this.$okay.prop("disabled",!this.$title.val()),this},render:function(){return wp.media.view.Modal.prototype.render.apply(this,arguments),this.$okay=this.$("#btn-ok"),this.$title=this.$("#title-input"),this.$blog_id=this.$('[name="blog_id"]'),this.$title.val(this.model.get("title")),this.setUIState(),this},onkeyup:function(e){27===e.originalEvent.keyCode&&this.close()},open:function(){wp.media.view.Modal.prototype.open.apply(this,arguments),this.$(".title").text(this.model.get("id")?i.editAccessArea:i.createAccessArea),this.setUIState()},save:function(){var e=this;this.model.set("title",this.$title.val()),this.model.set("blog_id",this.$blog_id.val()),this.model.save(null,{success:function(t){e.close()},error:function(e,t){var i=new Backbone.Model(t.responseJSON),s=new wp.accessAreas.view.Notice({model:i});i.set("dismissible",!0),i.set("type","error"),s.render().$el.prependTo(this.$(".modal-content"))}})}}),s.view.ModalAssign=wp.media.view.Modal.extend({template:wp.template("access-area-assign-modal"),events:{"click .modal-close":"close","click #btn-ok":"save","change select":"setUIState",keyup:"onkeyup"},onkeyup:function(e){return 27===e.originalEvent.keyCode&&this.close(),this},render:function(){return wp.media.view.Modal.prototype.render.apply(this,arguments),this.$okay=this.$("#btn-ok"),this.setUIState(),this},open:function(){return wp.media.view.Modal.prototype.open.apply(this,arguments),this.$(".title").text("grant"===this.model.get("action")?i.grantAccess:i.revokeAccess),this.$("select").val(""),this.setUIState(),this},setUIState:function(e){return console.log(this.$("select").val()),this.$okay.prop("disabled",""===this.$("select").val()),this},save:function(){var t=this;return this.model.set("id",this.$("select").val()),this.model.save(null,{success:function(i,s){var a=t.model.get("action");_.each(s.user_id,function(t,i){if("grant"===a){var n=e('.assign-access-areas[data-wpaa-user="'+t+'"]'),o=wp.template("access-area-assigned-user")(e.extend(s.access_area,{user_id:s.user_id}));n.prepend(o)}else"revoke"===a&&e('[data-wpaa-access-area="'+s.access_area.id+'"][data-wpaa-user="'+t+'"]').closest(".wpaa-access-area").remove()}),t.close()},error:function(e,t){var i=new Backbone.Model(t.responseJSON),s=new wp.accessAreas.view.Notice({model:i});i.set("dismissible",!0),i.set("type","error"),s.render().$el.prependTo(this.$(".modal-content"))}}),this}}),t.accessAreas=s}(jQuery,wp),function(e,t){var i=wp.accessAreas;e(document).ready(function(){var t=e(".access-areas-list-table");t.length&&new i.view.TableViewManage({el:t.get(0)})})}(jQuery),function(e,t){var i=wp.accessAreas,s=new i.model.Assign,a=new i.view.ModalAssign({model:s,propagate:!1});e(document).on("click","body.users-php .button.action",function(t){var i=e(this).prev("select").val(),n=[];t.preventDefault(),-1!==["wpaa-grant","wpaa-revoke"].indexOf(i)&&(e('[name="users[]"]:checked').each(function(t,i){n.push(e(this).val())}),s.set("action",i.replace("wpaa-","")),s.set("user_id",n),a.open())}).on("click","[data-wpaa-action]",function(t){t.preventDefault();var i=e(this).attr("data-wpaa-action"),n=this;s.set("action",i),s.set("user_id",e(this).attr("data-wpaa-user")),"revoke"===i?(e(this).closest(".wpaa-access-area").addClass("idle"),s.set("id",e(this).attr("data-wpaa-access-area")),s.save(null,{success:function(){e(n).closest(".wpaa-access-area").remove()},error:function(t,i){var s=new Backbone.Model(i.responseJSON),a=new wp.accessAreas.view.Notice({model:s});s.set("dismissible",!0),s.set("type","error"),a.render().$el.insertfter(e(".wp-header-end"))}})):"grant"===i&&a.open()})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJtYW5hZ2UuanMiLCJ1c2Vycy5qcyJdLCJuYW1lcyI6WyIkIiwiZXhwb3J0cyIsImwxMG4iLCJhY2Nlc3NfYXJlYXNfYWRtaW4iLCJ3cGFhIiwidmlldyIsIm1vZGVsIiwiQXNzaWduIiwiQmFja2JvbmUiLCJNb2RlbCIsImV4dGVuZCIsImRlZmF1bHRzIiwiaWQiLCJhY3Rpb24iLCJ1c2VycyIsInNhdmUiLCJ0aGlzIiwidXJsIiwid3BBcGlTZXR0aW5ncyIsInJvb3QiLCJ2ZXJzaW9uU3RyaW5nIiwiZ2V0IiwicHJvdG90eXBlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJOb3RpY2UiLCJ3cCIsIm1lZGlhIiwiVmlldyIsInRlbXBsYXRlIiwiZXZlbnRzIiwiY2xpY2sgLm5vdGljZS1kaXNtaXNzIiwiJGVsIiwicmVtb3ZlIiwiUm93Vmlld01hbmFnZSIsInRhZ05hbWUiLCJjbGljayBhLmRlbGV0ZSIsImNsaWNrIGEuZWRpdCIsImluaXRpYWxpemUiLCJsaXN0ZW5UbyIsImRpc2FibGUiLCJyZW5kZXIiLCJhdHRyIiwiZSIsImFkZENsYXNzIiwiZW5hYmxlIiwicmVtb3ZlQ2xhc3MiLCJkZWxldGUiLCJwcmV2ZW50RGVmYXVsdCIsImRlc3Ryb3kiLCJlZGl0IiwiY29udHJvbGxlciIsImVkaXRFbnRyeSIsIlRhYmxlVmlld01hbmFnZSIsImNsaWNrIC5hZGQiLCJzZWxmIiwiY29sbGVjdGlvbiIsImFwaSIsImNvbGxlY3Rpb25zIiwiQWNjZXNzQXJlYSIsImZldGNoIiwib25jZSIsImFkZFJvdyIsImNvbnNvbGUiLCJsb2ciLCJzZXRQbGFjZWhvbGRlciIsIm5ld0VudHJ5IiwibW9kZWxzIiwiSUQiLCJ0aXRsZSIsIm1vZGFsIiwib3BlbiIsInN0b3BMaXN0ZW5pbmciLCJ3aGVyZSIsImxlbmd0aCIsImFkZCIsImFwcGVuZCIsImVsIiwiaGFzUm93IiwiTW9kYWxNYW5hZ2UiLCIkcGxhY2Vob2xkZXIiLCJwYXJlbnQiLCJhcHBlbmRUbyIsIk1vZGFsIiwiY2xpY2sgLm1vZGFsLWNsb3NlIiwiY2xpY2sgI2J0bi1vayIsImtleXVwICN0aXRsZS1pbnB1dCIsImNoYW5nZSAjdGl0bGUtaW5wdXQiLCJibHVyICN0aXRsZS1pbnB1dCIsImtleXVwIiwic2V0VUlTdGF0ZSIsIiRva2F5IiwicHJvcCIsIiR0aXRsZSIsInZhbCIsIiRibG9nX2lkIiwib25rZXl1cCIsIm9yaWdpbmFsRXZlbnQiLCJrZXlDb2RlIiwiY2xvc2UiLCJ0ZXh0IiwiZWRpdEFjY2Vzc0FyZWEiLCJjcmVhdGVBY2Nlc3NBcmVhIiwic2V0Iiwic3VjY2VzcyIsImVycm9yIiwicmVzcG9uc2UiLCJyZXNwb25zZUpTT04iLCJub3RpY2UiLCJhY2Nlc3NBcmVhcyIsInByZXBlbmRUbyIsIk1vZGFsQXNzaWduIiwiY2hhbmdlIHNlbGVjdCIsImdyYW50QWNjZXNzIiwicmV2b2tlQWNjZXNzIiwiXyIsImVhY2giLCJ1c2VyX2lkIiwiaSIsIiRib3giLCJodG1sIiwiYWNjZXNzX2FyZWEiLCJwcmVwZW5kIiwiY2xvc2VzdCIsImpRdWVyeSIsImRvY3VtZW50IiwicmVhZHkiLCJwcm9wYWdhdGUiLCJvbiIsInByZXYiLCJpbmRleE9mIiwicHVzaCIsInJlcGxhY2UiLCJpbnNlcnRmdGVyIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQWdCQSxJQUFBQyxFQUFBQyxtQkFBQUQsS0FDQUUsR0FDQUYsS0FBQUEsRUFDQUcsUUFDQUMsVUFHQUYsRUFBQUUsTUFBQUMsT0FBQUMsU0FBQUMsTUFBQUMsUUFDQUMsVUFDQUMsR0FBQSxLQUNBQyxPQUFBLFFBQ0FDLFVBRUFDLEtBQUEsV0FFQUMsS0FBQUMsSUFBQUMsY0FBQUMsS0FBQUQsY0FBQUUsY0FBQSxlQUFBSixLQUFBSyxJQUFBLE1BQUEsSUFBQUwsS0FBQUssSUFBQSxVQUNBYixTQUFBQyxNQUFBYSxVQUFBUCxLQUFBUSxNQUFBUCxLQUFBUSxjQUtBcEIsRUFBQUMsS0FBQW9CLE9BQUFDLEdBQUFDLE1BQUFDLEtBQUFsQixR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QUEsVUFBQXZHLEVBQUFnQixNQUFBMEIsS0FBQSxtQkFFQSxXQUFBN0IsR0FDQWIsRUFBQWdCLE1BQUEyRyxRQUFBLHFCQUFBL0UsU0FBQSxRQUNBdEMsRUFBQWlHLElBQUEsS0FBQXZHLEVBQUFnQixNQUFBMEIsS0FBQSwwQkFDQXBDLEVBQUFTLEtBQUEsTUFDQXlGLFFBQUEsV0FDQXhHLEVBQUF1RCxHQUFBb0UsUUFBQSxxQkFBQTFGLFVBRUF3RSxNQUFBLFNBQUE5RCxFQUFBK0QsR0FDQSxJQUFBcEcsRUFBQSxJQUFBRSxTQUFBQyxNQUFBaUcsRUFBQUMsY0FDQUMsRUFBQSxJQUFBbEYsR0FBQW1GLFlBQUF4RyxLQUFBb0IsUUFDQW5CLE1BQUFBLElBRUFBLEVBQUFpRyxJQUFBLGVBQUEsR0FDQWpHLEVBQUFpRyxJQUFBLE9BQUEsU0FHQUssRUFBQW5FLFNBQUFULElBQUFxRyxXQUFBckksRUFBQSx1QkFHQSxVQUFBYSxHQUNBeUQsRUFBQUMsU0FyREEsQ0ErREFxRCIsImZpbGUiOiJhY2Nlc3MtYXJlYXMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCQsZXhwb3J0cyl7XG5cdC8vIHdwQXBpU2V0dGluZ3MubWFwcGluZyA9IHtcblx0Ly8gXHRtb2RlbHM6IHtcblx0Ly8gXHRcdCdBY2Nlc3NBcmVhcycgOiAnQWNjZXNzQXJlYSdcblx0Ly8gXHR9LFxuXHQvLyBcdGNvbGxlY3Rpb25zOnt9XG5cdC8vIH07XG5cdC8vIHdwLmFwaS5pbml0KHtcblx0Ly8gXHR2ZXJzaW9uU3RyaW5nIDogJ3dwYWEvdjEvJyxcblx0Ly8gXHRhcGlSb290OiB3cEFwaVNldHRpbmdzLnJvb3QsXG5cdC8vIFx0c2NoZW1hOiBudWxsLFxuXHQvLyBcdH0pXG5cdC8vIFx0LmRvbmUoIGZ1bmN0aW9uKCkge1xuXHQvLyBcdFx0Y29uc29sZS5sb2codGhpcywgd3AuYXBpLmVuZHBvaW50cy5maW5kKHt2ZXJzaW9uU3RyaW5nOid3cGFhL3YxLyd9KSApO1xuXHQvLyBcdH0pO1xuXG5cdHZhciBsMTBuID0gYWNjZXNzX2FyZWFzX2FkbWluLmwxMG4sXG5cdFx0d3BhYSA9IHtcblx0XHRcdGwxMG46IGwxMG4sXG5cdFx0XHR2aWV3OiB7fSxcblx0XHRcdG1vZGVsOiB7fVxuXHRcdH07XG5cblx0d3BhYS5tb2RlbC5Bc3NpZ24gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuXHRcdGRlZmF1bHRzOntcblx0XHRcdGlkOiBudWxsLFxuXHRcdFx0YWN0aW9uOidncmFudCcsXG5cdFx0XHR1c2VyczpbXVxuXHRcdH0sXG5cdFx0c2F2ZTpmdW5jdGlvbigpIHtcblxuXHRcdFx0dGhpcy51cmwgPSB3cEFwaVNldHRpbmdzLnJvb3QgKyB3cEFwaVNldHRpbmdzLnZlcnNpb25TdHJpbmcgKyAnYWNjZXNzLWFyZWEvJyArIHRoaXMuZ2V0KCdpZCcpICsgJy8nICsgdGhpcy5nZXQoJ2FjdGlvbicpO1xuXHRcdFx0QmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNhdmUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXG5cdFx0fVxuXHR9KTtcblxuXHR3cGFhLnZpZXcuTm90aWNlID0gd3AubWVkaWEuVmlldy5leHRlbmQoe1xuXHRcdHRlbXBsYXRlOiB3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtbm90aWNlJyksXG5cdFx0ZXZlbnRzOntcblx0XHRcdCdjbGljayAubm90aWNlLWRpc21pc3MnIDogZnVuY3Rpb24oKXtcblx0XHRcdFx0dGhpcy4kZWwucmVtb3ZlKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXHR3cGFhLnZpZXcuUm93Vmlld01hbmFnZSA9IHdwLm1lZGlhLlZpZXcuZXh0ZW5kKHtcblx0XHR0ZW1wbGF0ZTp3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtcm93JyksXG5cdFx0dGFnTmFtZTondHInLFxuXHRcdGV2ZW50czoge1xuXHRcdFx0J2NsaWNrIGEuZGVsZXRlJ1x0XHQ6ICdkZWxldGUnLFxuXHRcdFx0J2NsaWNrIGEuZWRpdCdcdFx0XHQ6ICdlZGl0Jyxcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0d3AubWVkaWEuVmlldy5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0XHR0aGlzLmxpc3RlblRvKCB0aGlzLm1vZGVsLCAnYmVmb3JlX3N5bmMnLCB0aGlzLmRpc2FibGUgKTtcblx0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMubW9kZWwsICdiZWZvcmVfZGVzdHJveScsIHRoaXMuZGlzYWJsZSApO1xuXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy5tb2RlbCwgJ3N5bmMnLCB0aGlzLnJlbmRlciApO1xuXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy5tb2RlbCwgJ2Rlc3Ryb3knLCB0aGlzLnJlbW92ZSApO1xuXHRcdH0sXG5cdFx0cmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLnJlbmRlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0XHR0aGlzLiRlbC5hdHRyKCdkYXRhLWlkJyx0aGlzLm1vZGVsLmdldCgnaWQnKSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGRpc2FibGU6ZnVuY3Rpb24oZSl7XG5cdFx0XHR0aGlzLiRlbC5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0ZW5hYmxlOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGRlbGV0ZTpmdW5jdGlvbihlKXtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHRoaXMubW9kZWwuZGVzdHJveSgpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRlZGl0OmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy5jb250cm9sbGVyLmVkaXRFbnRyeSh0aGlzLm1vZGVsKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0ZGVsZXRlOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy5tb2RlbC5kZXN0cm95KCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH0pO1xuXHR3cGFhLnZpZXcuVGFibGVWaWV3TWFuYWdlID0gd3AubWVkaWEuVmlldy5leHRlbmQoe1xuXHRcdGV2ZW50czoge1xuXHRcdFx0J2NsaWNrIC5hZGQnIDogJ25ld0VudHJ5Jyxcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0d3AubWVkaWEuVmlldy5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0XHR0aGlzLmNvbGxlY3Rpb24gPSBuZXcgd3AuYXBpLmNvbGxlY3Rpb25zLkFjY2Vzc0FyZWEoKTtcblx0XHRcdHRoaXMuY29sbGVjdGlvbi5mZXRjaCgpO1xuXHRcdFx0dGhpcy5jb2xsZWN0aW9uLm9uY2UoJ3N5bmMnLHRoaXMucmVuZGVyLHRoaXMpO1xuXHRcdFx0dGhpcy5saXN0ZW5Ubyh0aGlzLmNvbGxlY3Rpb24sJ2FkZCcsZnVuY3Rpb24obW9kZWwpe1xuXHRcdFx0XHRzZWxmLmFkZFJvdyhtb2RlbCk7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGFyZ3VtZW50cyk7XG5cdFx0XHR9KTtcblx0XHRcdHRoaXMubGlzdGVuVG8odGhpcy5jb2xsZWN0aW9uLCdyZW1vdmUnLGZ1bmN0aW9uKG1vZGVsKXtcblx0XHRcdFx0c2VsZi5zZXRQbGFjZWhvbGRlcigpO1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLnJlbmRlcigpO1xuXHRcdH0sXG5cdFx0bmV3RW50cnk6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dmFyIG1vZGVsID0gbmV3IHdwLmFwaS5tb2RlbHMuQWNjZXNzQXJlYSh7XG5cdFx0XHRcdFx0SUQ6IG51bGwsXG5cdFx0XHRcdFx0dGl0bGU6ICcnLFxuXHRcdFx0XHR9KTtcblx0XHRcdHRoaXMuZWRpdEVudHJ5KG1vZGVsKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0ZWRpdEVudHJ5OmZ1bmN0aW9uKG1vZGVsKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHQvLyBvcGVuIG1vZGFsXG5cdFx0XHR0aGlzLm1vZGFsLm1vZGVsID0gbW9kZWw7XG5cdFx0XHR0aGlzLm1vZGFsLnJlbmRlcigpLm9wZW4oe30pO1xuXHRcdFx0dGhpcy5saXN0ZW5Ubyhtb2RlbCwnc3luYycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYuc3RvcExpc3RlbmluZyhtb2RlbCwnc3luYycpO1xuXHRcdFx0XHRpZiAoICEgc2VsZi5jb2xsZWN0aW9uLndoZXJlKCB7IGlkOiBtb2RlbC5nZXQoJ2lkJykgfSApLmxlbmd0aCApIHtcblx0XHRcdFx0XHRzZWxmLmNvbGxlY3Rpb24uYWRkKG1vZGVsKTtcbi8vXHRcdFx0XHRcdFx0c2VsZi5hZGRSb3cobW9kZWwpO1xuXG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRhZGRSb3c6ZnVuY3Rpb24oIG1vZGVsICl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHZpZXcgPSBuZXcgd3BhYS52aWV3LlJvd1ZpZXdNYW5hZ2Uoe1xuXHRcdFx0XHRcdG1vZGVsOm1vZGVsLFxuXHRcdFx0XHRcdGNvbnRyb2xsZXI6dGhpcyxcblx0XHRcdFx0fSk7XG5cdFx0XHR0aGlzLiRlbC5hcHBlbmQoIHZpZXcucmVuZGVyKCkuZWwgKTtcblx0XHRcdHRoaXMubGlzdGVuVG8oIG1vZGVsLCdkZXN0cm95JyxmdW5jdGlvbihlKXtcblx0XHRcdFx0dmlldy4kZWwucmVtb3ZlKCk7XG5cdFx0XHRcdHNlbGYuc2V0UGxhY2Vob2xkZXIoKTtcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5zZXRQbGFjZWhvbGRlcigpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRoYXNSb3c6ZnVuY3Rpb24obW9kZWwpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJCgnW2RhdGEtaWQ9XCInK21vZGVsLmdldCgnaWQnKSsnXCJdJykubGVuZ3RoID4gMDtcblx0XHR9LFxuXHRcdHJlbmRlcjogZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0aWYgKCAhIHRoaXMubW9kYWwgKSB7XG5cdFx0XHRcdHRoaXMubW9kYWwgPSBuZXcgd3BhYS52aWV3Lk1vZGFsTWFuYWdlKHtcblx0XHRcdFx0XHRjb250cm9sbGVyOlx0dGhpcyxcblx0XHRcdFx0fSApO1xuXHRcdFx0fVxuXG5cdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXG5cdFx0XHR0aGlzLiRwbGFjZWhvbGRlciA9IHRoaXMuJCgnLnBsYWNlaG9sZGVyLXJvdycpO1xuXG5cdFx0XHR0aGlzLnNldFBsYWNlaG9sZGVyKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHNldFBsYWNlaG9sZGVyOmZ1bmN0aW9uKCl7XG5cdFx0XHRpZiAoIHRoaXMuY29sbGVjdGlvbi5sZW5ndGggKSB7XG5cdFx0XHRcdHRoaXMuJHBsYWNlaG9sZGVyLnJlbW92ZSgpO1xuXHRcdFx0fSBlbHNlIGlmICggISB0aGlzLiRwbGFjZWhvbGRlci5wYXJlbnQoKS5sZW5ndGggKSB7XG5cdFx0XHRcdHRoaXMuJHBsYWNlaG9sZGVyLmFwcGVuZFRvKCB0aGlzLmVsICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXG5cdHdwYWEudmlldy5Nb2RhbE1hbmFnZSA9IHdwLm1lZGlhLnZpZXcuTW9kYWwuZXh0ZW5kKHtcblx0XHR0ZW1wbGF0ZTp3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtbW9kYWwnKSxcblx0XHRldmVudHM6XHRcdHtcblx0XHRcdCdjbGljayAubW9kYWwtY2xvc2UnXHQ6ICdjbG9zZScsXG5cdFx0XHQnY2xpY2sgI2J0bi1vaydcdFx0XHQ6ICdzYXZlJyxcblx0XHRcdCdrZXl1cCAjdGl0bGUtaW5wdXQnXHQ6ICdzZXRVSVN0YXRlJyxcblx0XHRcdCdjaGFuZ2UgI3RpdGxlLWlucHV0J1x0OiAnc2V0VUlTdGF0ZScsXG5cdFx0XHQnYmx1ciAjdGl0bGUtaW5wdXQnXHRcdDogJ3NldFVJU3RhdGUnLFxuXHRcdFx0J2tleXVwJ1x0XHRcdFx0XHQ6ICdvbmtleXVwJyxcblx0XHR9LFxuXHRcdHNldFVJU3RhdGU6ZnVuY3Rpb24oZSl7XG5cdFx0XHR0aGlzLiRva2F5LnByb3AoJ2Rpc2FibGVkJywhdGhpcy4kdGl0bGUudmFsKCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0d3AubWVkaWEudmlldy5Nb2RhbC5wcm90b3R5cGUucmVuZGVyLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcblx0XHRcdHRoaXMuJG9rYXkgPSB0aGlzLiQoJyNidG4tb2snKTtcblx0XHRcdHRoaXMuJHRpdGxlID0gdGhpcy4kKCcjdGl0bGUtaW5wdXQnKTtcblx0XHRcdHRoaXMuJGJsb2dfaWQgPSB0aGlzLiQoJ1tuYW1lPVwiYmxvZ19pZFwiXScpO1xuXHRcdFx0dGhpcy4kdGl0bGUudmFsKCB0aGlzLm1vZGVsLmdldCggJ3RpdGxlJyApICk7XG5cdFx0XHR0aGlzLnNldFVJU3RhdGUoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0b25rZXl1cDpmdW5jdGlvbihlKSB7XG5cdFx0XHRpZiAoIGUub3JpZ2luYWxFdmVudC5rZXlDb2RlID09PSAyNyApIHtcblx0XHRcdFx0dGhpcy5jbG9zZSgpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0b3BlbjpmdW5jdGlvbigpe1xuXHRcdFx0d3AubWVkaWEudmlldy5Nb2RhbC5wcm90b3R5cGUub3Blbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG5cdFx0XHR0aGlzLiQoJy50aXRsZScpLnRleHQoICEhIHRoaXMubW9kZWwuZ2V0KCdpZCcpID8gbDEwbi5lZGl0QWNjZXNzQXJlYSA6IGwxMG4uY3JlYXRlQWNjZXNzQXJlYSApO1xuXHRcdFx0dGhpcy5zZXRVSVN0YXRlKCk7XG5cdFx0fSxcblx0XHRzYXZlOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHR0aGlzLm1vZGVsLnNldCgndGl0bGUnLCB0aGlzLiR0aXRsZS52YWwoKSApO1xuXHRcdFx0dGhpcy5tb2RlbC5zZXQoJ2Jsb2dfaWQnLCB0aGlzLiRibG9nX2lkLnZhbCgpICk7XG5cdFx0XHR0aGlzLm1vZGVsLnNhdmUoIG51bGwsIHtcblx0XHRcdFx0c3VjY2VzczogZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHNlbGYuY2xvc2UoKTtcblx0XHRcdFx0XHQvLyBhZGQgbWVzc2FnZVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRlcnJvcjogZnVuY3Rpb24oZSxyZXNwb25zZSkge1xuXHRcdFx0XHRcdHZhciBtb2RlbCA9IG5ldyBCYWNrYm9uZS5Nb2RlbChyZXNwb25zZS5yZXNwb25zZUpTT04pLFxuXHRcdFx0XHRcdFx0bm90aWNlID0gbmV3IHdwLmFjY2Vzc0FyZWFzLnZpZXcuTm90aWNlKHtcblx0XHRcdFx0XHRcdFx0bW9kZWw6IG1vZGVsXG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRtb2RlbC5zZXQoJ2Rpc21pc3NpYmxlJyx0cnVlKTtcblx0XHRcdFx0XHRtb2RlbC5zZXQoJ3R5cGUnLCdlcnJvcicpO1xuXHRcdFx0XHRcdC8vIHByaW50IG1lc3NhZ2Vcblx0XHRcdFx0XHQvL3RoaXMuJCgnLm5vdGljZScpLnJlbW92ZSgpO1xuXHRcdFx0XHRcdG5vdGljZS5yZW5kZXIoKS4kZWwucHJlcGVuZFRvKHRoaXMuJCgnLm1vZGFsLWNvbnRlbnQnKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cdH0pO1xuXG5cdHdwYWEudmlldy5Nb2RhbEFzc2lnbiA9IHdwLm1lZGlhLnZpZXcuTW9kYWwuZXh0ZW5kKHtcblx0XHR0ZW1wbGF0ZTp3cC50ZW1wbGF0ZSgnYWNjZXNzLWFyZWEtYXNzaWduLW1vZGFsJyksXG5cdFx0ZXZlbnRzOlx0XHR7XG5cdFx0XHQnY2xpY2sgLm1vZGFsLWNsb3NlJ1x0OiAnY2xvc2UnLFxuXHRcdFx0J2NsaWNrICNidG4tb2snXHRcdFx0OiAnc2F2ZScsXG5cdFx0XHQnY2hhbmdlIHNlbGVjdCdcdFx0XHQ6ICdzZXRVSVN0YXRlJyxcblx0XHRcdCdrZXl1cCdcdFx0XHRcdFx0OiAnb25rZXl1cCcsXG5cdFx0fSxcblx0XHRvbmtleXVwOmZ1bmN0aW9uKGUpIHtcblx0XHRcdGlmICggZS5vcmlnaW5hbEV2ZW50LmtleUNvZGUgPT09IDI3ICkge1xuXHRcdFx0XHR0aGlzLmNsb3NlKCk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHR3cC5tZWRpYS52aWV3Lk1vZGFsLnByb3RvdHlwZS5yZW5kZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xuXHRcdFx0dGhpcy4kb2theSA9IHRoaXMuJCgnI2J0bi1vaycpO1xuXHRcdFx0dGhpcy5zZXRVSVN0YXRlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdG9wZW46ZnVuY3Rpb24oKXtcblx0XHRcdHdwLm1lZGlhLnZpZXcuTW9kYWwucHJvdG90eXBlLm9wZW4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xuXHRcdFx0dGhpcy4kKCcudGl0bGUnKS50ZXh0KCB0aGlzLm1vZGVsLmdldCgnYWN0aW9uJykgPT09ICdncmFudCcgPyBsMTBuLmdyYW50QWNjZXNzIDogbDEwbi5yZXZva2VBY2Nlc3MgKTtcblx0XHRcdHRoaXMuJCgnc2VsZWN0JykudmFsKCcnKVxuXHRcdFx0dGhpcy5zZXRVSVN0YXRlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHNldFVJU3RhdGU6ZnVuY3Rpb24oZSl7XG5cdFx0XHRjb25zb2xlLmxvZyh0aGlzLiQoJ3NlbGVjdCcpLnZhbCgpKTtcblx0XHRcdHRoaXMuJG9rYXkucHJvcCgnZGlzYWJsZWQnLHRoaXMuJCgnc2VsZWN0JykudmFsKCk9PT0nJyk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHNhdmU6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHRoaXMubW9kZWwuc2V0KCdpZCcsdGhpcy4kKCdzZWxlY3QnKS52YWwoKSk7XG5cdFx0XHR0aGlzLm1vZGVsLnNhdmUoIG51bGwsIHtcblx0XHRcdFx0c3VjY2VzczogZnVuY3Rpb24oZSxyZXNwb25zZSkge1xuXHRcdFx0XHRcdHZhciBhY3Rpb24gPSBzZWxmLm1vZGVsLmdldCgnYWN0aW9uJyk7XG5cdFx0XHRcdFx0Xy5lYWNoKHJlc3BvbnNlLnVzZXJfaWQsZnVuY3Rpb24odXNlcl9pZCxpKXtcblx0XHRcdFx0XHRcdGlmICggJ2dyYW50JyA9PT0gYWN0aW9uICkge1xuXHRcdFx0XHRcdFx0XHR2YXIgJGJveCA9ICQoJy5hc3NpZ24tYWNjZXNzLWFyZWFzW2RhdGEtd3BhYS11c2VyPVwiJyArIHVzZXJfaWQgKyAnXCJdJyksXG5cdFx0XHRcdFx0XHRcdFx0aHRtbCA9IHdwLnRlbXBsYXRlKCdhY2Nlc3MtYXJlYS1hc3NpZ25lZC11c2VyJykoJC5leHRlbmQocmVzcG9uc2UuYWNjZXNzX2FyZWEse1xuXHRcdFx0XHRcdFx0XHRcdFx0dXNlcl9pZDpyZXNwb25zZS51c2VyX2lkLFxuXHRcdFx0XHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0XHRcdFx0JGJveC5wcmVwZW5kKGh0bWwpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICggJ3Jldm9rZScgPT09IGFjdGlvbiApIHtcblx0XHRcdFx0XHRcdFx0JCgnW2RhdGEtd3BhYS1hY2Nlc3MtYXJlYT1cIicrcmVzcG9uc2UuYWNjZXNzX2FyZWEuaWQrJ1wiXVtkYXRhLXdwYWEtdXNlcj1cIicrdXNlcl9pZCsnXCJdJylcblx0XHRcdFx0XHRcdFx0XHQuY2xvc2VzdCgnLndwYWEtYWNjZXNzLWFyZWEnKVxuXHRcdFx0XHRcdFx0XHRcdC5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHNlbGYuY2xvc2UoKTtcblx0XHRcdFx0XHQvLyBhZGQgbWVzc2FnZVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRlcnJvcjogZnVuY3Rpb24oZSxyZXNwb25zZSkge1xuXHRcdFx0XHRcdHZhciBtb2RlbCA9IG5ldyBCYWNrYm9uZS5Nb2RlbChyZXNwb25zZS5yZXNwb25zZUpTT04pLFxuXHRcdFx0XHRcdFx0bm90aWNlID0gbmV3IHdwLmFjY2Vzc0FyZWFzLnZpZXcuTm90aWNlKHtcblx0XHRcdFx0XHRcdFx0bW9kZWw6IG1vZGVsXG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRtb2RlbC5zZXQoJ2Rpc21pc3NpYmxlJyx0cnVlKTtcblx0XHRcdFx0XHRtb2RlbC5zZXQoJ3R5cGUnLCdlcnJvcicpO1xuXHRcdFx0XHRcdC8vIHByaW50IG1lc3NhZ2Vcblx0XHRcdFx0XHQvL3RoaXMuJCgnLm5vdGljZScpLnJlbW92ZSgpO1xuXHRcdFx0XHRcdG5vdGljZS5yZW5kZXIoKS4kZWwucHJlcGVuZFRvKHRoaXMuJCgnLm1vZGFsLWNvbnRlbnQnKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9KTtcblxuXG5cblxuXHRleHBvcnRzLmFjY2Vzc0FyZWFzID0gd3BhYTtcbn0pKGpRdWVyeSx3cCk7XG4iLCIoZnVuY3Rpb24oJCxleHBvcnRzKXtcblxuXHR2YXIgd3BhYSA9IGV4cG9ydHMuYWNjZXNzQXJlYXM7XG5cblxuXHQkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xuXHRcdHZhciAkZWwgPSAkKCcuYWNjZXNzLWFyZWFzLWxpc3QtdGFibGUnKTtcblx0XHRpZiAoICRlbC5sZW5ndGggKSB7XG5cdFx0XHRuZXcgd3BhYS52aWV3LlRhYmxlVmlld01hbmFnZSh7XG5cdFx0XHRcdGVsOiAkZWwuZ2V0KDApXG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xuXG59KShqUXVlcnksd3ApO1xuIiwiKGZ1bmN0aW9uKCQsZXhwb3J0cyl7XG5cblx0dmFyIHdwYWEgPSBleHBvcnRzLmFjY2Vzc0FyZWFzLFxuXHRcdG1vZGVsID0gbmV3IHdwYWEubW9kZWwuQXNzaWduKCksXG5cdFx0bW9kYWwgPSBuZXcgd3BhYS52aWV3Lk1vZGFsQXNzaWduKHttb2RlbDptb2RlbCxwcm9wYWdhdGU6ZmFsc2V9KTtcblxuXG5cblx0JChkb2N1bWVudClcblx0XHQub24oJ2NsaWNrJywnYm9keS51c2Vycy1waHAgLmJ1dHRvbi5hY3Rpb24nLGZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGFjdGlvbiA9ICQodGhpcykucHJldignc2VsZWN0JykudmFsKCksXG5cdFx0XHRcdHVzZXJzID0gW107XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRpZiAoIFsnd3BhYS1ncmFudCcsJ3dwYWEtcmV2b2tlJ10uaW5kZXhPZihhY3Rpb24pICE9PSAtMSApIHtcblx0XHRcdFx0JCgnW25hbWU9XCJ1c2Vyc1tdXCJdOmNoZWNrZWQnKS5lYWNoKGZ1bmN0aW9uKGksZWwpe1xuXHRcdFx0XHRcdHVzZXJzLnB1c2goJCh0aGlzKS52YWwoKSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdG1vZGVsLnNldCgnYWN0aW9uJywgYWN0aW9uLnJlcGxhY2UoJ3dwYWEtJywnJykpO1xuXHRcdFx0XHRtb2RlbC5zZXQoJ3VzZXJfaWQnLCB1c2VycyApO1xuXHRcdFx0XHRtb2RhbC5vcGVuKCk7XG5cdFx0XHR9XG5cdFx0fSlcblx0XHQub24oJ2NsaWNrJywnW2RhdGEtd3BhYS1hY3Rpb25dJyxmdW5jdGlvbihlKXtcblxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHR2YXIgYWN0aW9uID0gJCh0aGlzKS5hdHRyKCdkYXRhLXdwYWEtYWN0aW9uJyksXG5cdFx0XHRcdHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRtb2RlbC5zZXQoJ2FjdGlvbicsIGFjdGlvbiApO1xuXHRcdFx0bW9kZWwuc2V0KCd1c2VyX2lkJywgJCh0aGlzKS5hdHRyKCdkYXRhLXdwYWEtdXNlcicpICk7XG5cblx0XHRcdGlmICggYWN0aW9uID09PSAncmV2b2tlJyApIHtcblx0XHRcdFx0JCh0aGlzKS5jbG9zZXN0KCcud3BhYS1hY2Nlc3MtYXJlYScpLmFkZENsYXNzKCdpZGxlJyk7XG5cdFx0XHRcdG1vZGVsLnNldCggJ2lkJywgJCh0aGlzKS5hdHRyKCdkYXRhLXdwYWEtYWNjZXNzLWFyZWEnKSApO1xuXHRcdFx0XHRtb2RlbC5zYXZlKG51bGwse1xuXHRcdFx0XHRcdHN1Y2Nlc3M6ZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdCQoc2VsZikuY2xvc2VzdCgnLndwYWEtYWNjZXNzLWFyZWEnKS5yZW1vdmUoKTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGVycm9yOmZ1bmN0aW9uKGUscmVzcG9uc2UpIHtcblx0XHRcdFx0XHRcdHZhciBtb2RlbCA9IG5ldyBCYWNrYm9uZS5Nb2RlbChyZXNwb25zZS5yZXNwb25zZUpTT04pLFxuXHRcdFx0XHRcdFx0XHRub3RpY2UgPSBuZXcgd3AuYWNjZXNzQXJlYXMudmlldy5Ob3RpY2Uoe1xuXHRcdFx0XHRcdFx0XHRcdG1vZGVsOiBtb2RlbFxuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdG1vZGVsLnNldCgnZGlzbWlzc2libGUnLHRydWUpO1xuXHRcdFx0XHRcdFx0bW9kZWwuc2V0KCd0eXBlJywnZXJyb3InKTtcblx0XHRcdFx0XHRcdC8vIHByaW50IG1lc3NhZ2Vcblx0XHRcdFx0XHRcdC8vdGhpcy4kKCcubm90aWNlJykucmVtb3ZlKCk7XG5cdFx0XHRcdFx0XHRub3RpY2UucmVuZGVyKCkuJGVsLmluc2VydGZ0ZXIoJCgnLndwLWhlYWRlci1lbmQnKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAoIGFjdGlvbiA9PT0gJ2dyYW50JyApIHtcblx0XHRcdFx0bW9kYWwub3BlbigpO1xuXHRcdFx0fVxuXHRcdH0pXG5cdFx0Ly8gLm9uKCdjbGljaycsJ1tkYXRhLXdwYWEtYWN0aW9uXScsZnVuY3Rpb24oZSl7XG5cdFx0Ly8gXHRlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIC8vXG5cdFx0Ly8gfSlcblx0XHQ7XG5cblxufSkoalF1ZXJ5LHdwKTtcbiJdfQ==
